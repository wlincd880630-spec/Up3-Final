<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Great Race: Origin of the Chinese Zodiac</title>
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --p: #F2C94C;
            --a: #E67E22;
            --bg: #F9F5F0;
            --card: #FFFFFF;
            --txt: #333333;
            --sub: #777777;
            --rad: 12px;
            --shd: 0 4px 20px rgba(0,0,0,0.1);
            --f-head: 'Noto Serif SC', serif;
            --f-body: 'Roboto', sans-serif;
            /* 修复2: 定义安全区域变量 */
            --sat: env(safe-area-inset-top);
            --sab: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            margin: 0; 
            font-family: var(--f-body); 
            background: var(--bg); 
            color: var(--txt); 
            /* 修复3: 使用 dvh 解决移动端地址栏遮挡问题，回退兼容 vh */
            height: 100vh; 
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        h1, h2, h3, .brand { font-family: var(--f-head); }

        /* 头部适配刘海屏 */
        .header { 
            background: rgba(255,255,255,0.95); 
            padding: 0 15px; 
            /* 增加顶部内边距适配刘海 */
            padding-top: var(--sat);
            height: calc(60px + var(--sat)); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid rgba(0,0,0,0.05); 
            z-index: 100; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.02); 
            flex-shrink: 0;
        }
        
        .brand { 
            font-weight: 800; 
            font-size: 1rem; 
            color: var(--p); 
            overflow: hidden; 
            white-space: nowrap; 
            text-overflow: ellipsis; 
            max-width: 60%; 
        }
        
        .score-pill { 
            background: var(--bg); 
            border: 1px solid var(--a); 
            color: var(--p); 
            padding: 4px 10px; 
            border-radius: 20px; 
            font-weight: 700; 
            font-size: 0.85rem; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
        }

        .page { 
            display: none; 
            flex: 1; /* 占据剩余空间 */
            flex-direction: column; 
            overflow-y: auto; /* 允许内部滚动 */
            overflow-x: hidden;
            padding: 15px; 
            padding-bottom: calc(20px + var(--sab)); /* 底部增加安全距离，防止按钮贴底 */
            animation: fadeIn 0.4s ease; 
        }
        .page.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .container { 
            width: 100%; 
            max-width: 1100px; 
            margin: 0 auto; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            height: 100%; /* 确保容器撑满页面 */
        }
        
        /* 居中布局页面 */
        #p1 .container, #p4 .container, #p7 .container { 
            justify-content: center; 
            align-items: center; 
            min-height: auto; /* 移动端不需要强制全高，flex居中即可 */
        }

        .card { 
            background: var(--card); 
            border-radius: var(--rad); 
            padding: 20px; /* 移动端减少 Padding */
            box-shadow: var(--shd); 
            border: 1px solid rgba(0,0,0,0.03); 
            position: relative; 
            width: 100%;
        }

        .btn { 
            background: var(--p); 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 10px; 
            font-weight: 600; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            font-size: 1rem; 
            transition: 0.2s; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 2px solid var(--p); color: var(--p); box-shadow: none; }
        
        /* --- 修复4: 视频页面布局重构 (关键修复) --- */
        .vt-layout { 
            display: flex; 
            flex-direction: column; /* 移动端默认垂直排列 */
            background: #000; 
            border-radius: var(--rad); 
            overflow: hidden; 
            box-shadow: var(--shd); 
            width: 100%;
            height: 100%; /* 撑满容器 */
            flex: 1;
        }

        .vt-video-col { 
            position: relative; 
            background: #000; 
            width: 100%;
            /* 移动端强制 16:9，防止被压缩为0 */
            aspect-ratio: 16/9; 
            flex-shrink: 0; /* 禁止被压缩 */
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        
        video { width: 100%; height: 100%; object-fit: contain; }

        .vt-sub-box { 
            background: white; 
            display: flex; 
            flex-direction: column; 
            flex: 1; /* 字幕区域占据剩余高度 */
            min-height: 0; /* Flexbox 滚动必须属性 */
            overflow: hidden; 
        }

        /* 桌面端布局适配 */
        @media(min-width: 1024px) { 
            .vt-layout { flex-direction: row; } 
            .vt-video-col { flex: 3; height: 100%; aspect-ratio: auto; } 
            .vt-sub-box { flex: 1; border-left: 1px solid #333; max-width: 400px; height: 100%; } 
            /* 桌面端卡片 Padding 恢复 */
            .card { padding: 30px; }
        }

        .sub-list { flex: 1; overflow-y: auto; padding: 15px; scroll-behavior: smooth; }
        .sub-line { padding: 8px; margin-bottom: 6px; border-radius: 6px; color: var(--sub); line-height: 1.5; border-left: 3px solid transparent; transition: 0.2s; font-size: 0.95rem; }
        .sub-line.active { background: #F8FAFC; color: var(--txt); font-weight: 600; border-left-color: var(--p); }
        .w-click { cursor: pointer; padding: 2px; border-radius: 3px; }
        .w-click:hover { background: var(--a); color: white; }

        .hud { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: #fff; padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; pointer-events: none; z-index: 20; opacity: 0; transition: opacity 0.3s; width: 90%; text-align: center; }
        .hud.show { opacity: 1; }

        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 50; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .q-card { background: var(--card); width: 100%; max-width: 500px; padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-height: 90%; overflow-y: auto; }

        .opt-btn { display: block; width: 100%; text-align: left; padding: 12px; margin-bottom: 8px; border: 2px solid #E5E7EB; border-radius: 8px; background: white; cursor: pointer; color: var(--text-main); font-weight: 500; font-size: 0.95rem; }
        .opt-btn.correct { background: #ECFDF5; border-color: #10B981; color: #065F46; }
        .opt-btn.wrong { background: #FEF2F2; border-color: #EF4444; color: #991B1B; }

        .modal-mask { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: white; width: 100%; max-width: 500px; border-radius: 20px; padding: 25px; position: relative; max-height: 85vh; overflow-y: auto; }
        .blur-txt { filter: blur(5px); opacity: 0.6; }
        .blur-txt.revealed { filter: none; opacity: 1; }

        .vocab-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; width: 100%; }
        .flashcard { background: var(--card); border-radius: 12px; padding: 15px; text-align: center; border: 1px solid rgba(0,0,0,0.1); cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); min-height: 140px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .flashcard.learned { background: #F0FDF4; border-color: #86EFAC; }

        #ds-pop { position: fixed; bottom: calc(20px + var(--sab)); left: 50%; transform: translateX(-50%); width: 92%; max-width: 400px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.25); z-index: 3000; display: none; border: 1px solid #E5E7EB; }

        /* 移动端特定文字大小调整 */
        @media(max-width: 480px) {
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.5rem; }
            .start-icon { font-size: 3rem !important; } /* 缩小首页图标 */
            .page { padding: 10px; }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="brand"><i class="fas fa-play-circle"></i> The Great Race</div>
    <div style="display:flex; align-items:center; gap:10px;">
        <button id="resume-btn-head" class="btn btn-sm btn-outline" style="display:none; padding:4px 10px; font-size:0.75rem;" onclick="resumeApp()">Resume</button>
        <div class="score-pill"><i class="fas fa-star"></i> <span id="u-score">0</span></div>
        <button class="btn btn-sm" style="padding:6px 10px; font-size:0.8rem;" onclick="saveState(true)"><i class="fas fa-save"></i></button>
    </div>
</div>

<div id="p1" class="page active">
    <div class="container">
        <div class="card" style="text-align:center; width:100%; max-width:600px; display:flex; flex-direction:column; align-items:center;">
            <div class="start-icon" style="font-size:4rem; color:var(--p); margin-bottom:15px;"><i class="fas fa-flag-checkered"></i></div>
            <h1>Mission Start</h1>
            <p style="color:var(--sub); margin-bottom:20px;">The Great Race: Origin of the Chinese Zodiac</p>
            
            <div style="background:rgba(0,0,0,0.03); border-radius:12px; padding:15px; text-align:left; margin-bottom:20px; border:1px dashed var(--p); width:100%;">
                <h3 style="margin-top:0; font-size:1rem;">Rewards:</h3>
                <div style="font-size:0.9rem; margin-bottom:5px;"><i class="fas fa-book-open" style="color:var(--p);"></i> Vocab (+2 pts)</div>
                <div style="font-size:0.9rem; margin-bottom:5px;"><i class="fas fa-puzzle-piece" style="color:var(--p);"></i> Quiz (+/- 1 pt)</div>
                <div style="font-size:0.9rem;"><i class="fas fa-film" style="color:var(--p);"></i> Video (+5 pts)</div>
            </div>
            
            <input type="text" id="username" placeholder="Enter Name" style="width:100%; padding:12px; border-radius:10px; border:2px solid #E5E7EB; margin-bottom:15px; font-size:1rem; text-align:center;">
            <button class="btn" style="width:100%; padding:15px; font-size:1.1rem;" onclick="startApp()">Start <i class="fas fa-arrow-right"></i></button>
            <div style="margin-top:10px; width:100%;"><button id="resume-btn-main" class="btn btn-outline" style="display:none; width:100%;" onclick="resumeApp()">Resume</button></div>
        </div>
    </div>
</div>

<div id="p2" class="page">
    <div class="container">
        <div class="card" style="height:100%; display:flex; flex-direction:column; padding: 15px;">
            <h2 style="margin-top:0; margin-bottom:10px; flex-shrink:0;">Overview</h2>
            
            <div class="slide-container" style="position:relative; height:220px; width:100%; max-width:500px; margin:0 auto 15px auto; background:#000; border-radius:12px; overflow:hidden; flex-shrink:0;">
                <div class="slide-img" style="display:block; width:100%; height:100%;">
                    <img src="Video_Homework_img_1.jpg" style="width:100%; height:100%; object-fit:cover; opacity:0.9;">
                    <div style="position:absolute; bottom:0; width:100%; background:linear-gradient(transparent, rgba(0,0,0,0.9)); color:white; padding:8px 15px; font-size:0.85rem;">The Jade Emperor announcing the Great Race.</div>
                </div>
                <div class="slide-img" style="display:none; width:100%; height:100%;">
                    <img src="Video_Homework_img_2.jpg" style="width:100%; height:100%; object-fit:cover; opacity:0.9;">
                    <div style="position:absolute; bottom:0; width:100%; background:linear-gradient(transparent, rgba(0,0,0,0.9)); color:white; padding:8px 15px; font-size:0.85rem;">The Rat jumping off the Ox's head.</div>
                </div>
                <div class="slide-img" style="display:none; width:100%; height:100%;">
                    <img src="Video_Homework_img_3.jpg" style="width:100%; height:100%; object-fit:cover; opacity:0.9;">
                    <div style="position:absolute; bottom:0; width:100%; background:linear-gradient(transparent, rgba(0,0,0,0.9)); color:white; padding:8px 15px; font-size:0.85rem;">Raft carrying Sheep, Monkey, and Rooster.</div>
                </div>
                <div class="slide-img" style="display:none; width:100%; height:100%;">
                    <img src="Video_Homework_img_4.jpg" style="width:100%; height:100%; object-fit:cover; opacity:0.9;">
                    <div style="position:absolute; bottom:0; width:100%; background:linear-gradient(transparent, rgba(0,0,0,0.9)); color:white; padding:8px 15px; font-size:0.85rem;">The 12 animals of the Chinese Zodiac.</div>
                </div>
                <button onclick="slide(-1)" style="position:absolute; top:50%; left:5px; transform:translateY(-50%); background:rgba(255,255,255,0.3); border:none; width:32px; height:32px; border-radius:50%; color:white; cursor:pointer;">❮</button>
                <button onclick="slide(1)" style="position:absolute; top:50%; right:5px; transform:translateY(-50%); background:rgba(255,255,255,0.3); border:none; width:32px; height:32px; border-radius:50%; color:white; cursor:pointer;">❯</button>
            </div>

            <div style="flex:1; overflow-y:auto; padding-right:5px; margin-bottom:10px; min-height:0;">
                <p style="line-height:1.6; margin-bottom:15px; font-size:0.95rem;">The Chinese Zodiac (Shengxiao) assigns an animal to each birth year based on the Great Race myth. The Jade Emperor organized a race for animals to cross a river, with the first 12 earning a spot on the Zodiac calendar. <i class="fas fa-volume-up" style="color:var(--p); cursor:pointer;" onclick="speak('The Chinese Zodiac assigns an animal to each birth year based on the Great Race myth.')"></i></p>
                <p style="line-height:1.6; margin-bottom:15px; font-size:0.95rem;">The Rat secured first place by riding the Ox. The Ox, Tiger, Rabbit, Dragon, Horse, Snake, Sheep, Monkey, Rooster, Dog, and Pig followed in that order. <i class="fas fa-volume-up" style="color:var(--p); cursor:pointer;" onclick="speak('The Rat secured first place by riding the Ox.')"></i></p>
                <p style="line-height:1.6; margin-bottom:15px; font-size:0.95rem;">The calendar combines 12 Earthly Branches (animals) with 10 Heavenly Stems, creating a 60-year cycle. Variations exist, such as the Cat replacing the Rabbit in Vietnam. <i class="fas fa-volume-up" style="color:var(--p); cursor:pointer;" onclick="speak('The calendar creates a 60-year cycle.')"></i></p>
            </div>
            
            <div style="flex-shrink:0; text-align:right;">
                <button class="btn" style="width:100%;" onclick="toPage('p3')">Next: Vocab <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>
</div>

<div id="p3" class="page">
    <div class="container">
        <div class="card" style="height:100%; display:flex; flex-direction:column;">
            <h2 style="flex-shrink:0; margin-top:0;">Vocabulary</h2>
            <div class="vocab-grid" id="v-grid" style="flex:1; overflow-y:auto; align-content:start;"></div> 
            <div style="flex-shrink:0; text-align:center; margin-top:15px;">
                <button class="btn" style="width:100%;" onclick="toPage('p4')">Take Quiz <i class="fas fa-gamepad"></i></button>
            </div>
        </div>
    </div>
</div>

<div id="p4" class="page">
    <div class="container">
        <div class="card" style="text-align:center; width:100%; max-width:600px;">
            <div id="qz-setup">
                <h2>Select Difficulty</h2>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;">
                    <button class="btn btn-outline" style="padding:15px;" onclick="startQuiz(0.3, 30)">
                        <div style="font-weight:800;">Beginner</div>
                        <div style="font-size:0.75rem; opacity:0.8;">30 pts</div>
                    </button>
                    <button class="btn btn-outline" style="padding:15px;" onclick="startQuiz(0.5, 60)">
                        <div style="font-weight:800;">Medium</div>
                        <div style="font-size:0.75rem; opacity:0.8;">60 pts</div>
                    </button>
                    <button class="btn btn-outline" style="padding:15px;" onclick="startQuiz(0.8, 100)">
                        <div style="font-weight:800;">Hard</div>
                        <div style="font-size:0.75rem; opacity:0.8;">100 pts</div>
                    </button>
                    <button class="btn btn-outline" style="padding:15px;" onclick="startQuiz(1.0, 140)">
                        <div style="font-weight:800;">Expert</div>
                        <div style="font-size:0.75rem; opacity:0.8;">140 pts</div>
                    </button>
                </div>
            </div>
            <div id="qz-run" style="display:none; text-align:left;">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <strong>Q <span id="q-idx">1</span></strong>
                    <span style="color:var(--p); font-weight:800;">Score: <span id="q-score">0</span></span>
                </div>
                <div id="q-content"></div>
                <div id="q-fb" style="display:none; margin-top:15px; padding:12px; background:#F8FAFC; border-radius:10px;"></div>
                <button id="q-nxt" class="btn" style="width:100%; margin-top:15px; display:none;" onclick="nextQ()">Next</button>
            </div>
        </div>
    </div>
</div>

<div id="p5" class="page">
    <div class="container" style="max-width:1400px; height:100%; padding:0;">
        <div class="vt-layout">
            <div class="vt-video-col">
                <div id="hud" class="hud">Loading...</div>
                <video id="vid1" src="Video.mp4" playsinline webkit-playsinline></video>
                
                <div id="ol1" class="overlay">
                    <div class="q-card">
                        <h3 id="v-q" style="color:var(--p); margin-top:0;">Question</h3>
                        <div id="v-opts" style="display:flex; flex-direction:column; gap:8px;"></div>
                        <div id="v-fb" style="display:none; margin-top:15px; background:#F9FAFB; padding:10px; border-radius:10px; text-align:left;"></div>
                        <div style="margin-top:15px; display:flex; gap:10px; justify-content:center;">
                            <button class="btn btn-outline" id="btn-rp" onclick="replaySeg()"><i class="fas fa-undo"></i> Replay</button>
                            <button class="btn" id="btn-cont" onclick="resumeVid()" style="display:none;">Continue</button>
                        </div>
                    </div>
                </div>

                <div id="rev1" class="overlay">
                    <div class="q-card">
                        <h2 style="color:var(--p);">Section Complete</h2>
                        <div id="rev-list" style="max-height:200px; overflow-y:auto; text-align:left; margin:15px 0;"></div>
                        <button class="btn" onclick="nextPhase()">Next Phase <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>

                <div class="controls" style="position:absolute; bottom:0; left:0; width:100%; padding:10px; background:linear-gradient(transparent, rgba(0,0,0,0.8)); display:flex; gap:10px; align-items:center;">
                    <button class="btn btn-sm" style="background:white; color:black; border-radius:50%; width:32px; height:32px; padding:0; display:flex; align-items:center; justify-content:center;" onclick="togglePlay()"><i class="fas fa-play" style="font-size:0.8rem; margin-left:2px;"></i></button>
                    <input type="range" id="seek-bar" value="0" style="flex:1; height:4px;">
                </div>
            </div>
            
            <div class="vt-sub-box">
                <div style="padding:10px 15px; border-bottom:1px solid #eee; font-weight:bold; color:var(--sub); font-size:0.85rem; flex-shrink:0;">TRANSCRIPT <span style="font-weight:normal; font-size:0.75rem;">(Tap words)</span></div>
                <div class="sub-list" id="sub-list"></div>
            </div>
        </div>
    </div>
</div>

<div id="p7" class="page">
    <div class="container">
        <div class="card" style="text-align:center; width:100%; max-width:600px;">
            <div style="font-size:3rem; color:var(--a); margin-bottom:15px;"><i class="fas fa-trophy"></i></div>
            <h1 style="color:var(--p); margin:0 0 10px 0;">Mission Report</h1>
            <p>Great Job, <span id="r-name" style="font-weight:bold;">Agent</span>!</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:20px 0;">
                <div style="background:var(--bg); padding:15px; border-radius:10px;"><div id="r-voc" style="font-size:1.5rem; font-weight:800; color:var(--p);">0</div><div style="font-size:0.8rem;">Vocab</div></div>
                <div style="background:var(--bg); padding:15px; border-radius:10px;"><div id="r-quiz" style="font-size:1.5rem; font-weight:800; color:var(--p);">0</div><div style="font-size:0.8rem;">Quiz</div></div>
                <div style="background:var(--bg); padding:15px; border-radius:10px;"><div id="r-vid" style="font-size:1.5rem; font-weight:800; color:var(--p);">0</div><div style="font-size:0.8rem;">Video</div></div>
                <div style="background:var(--bg); padding:15px; border-radius:10px;"><div id="r-time" style="font-size:1.5rem; font-weight:800; color:var(--p);">0m</div><div style="font-size:0.8rem;">Time</div></div>
            </div>
            <div style="font-size:1rem; color:#888; margin-bottom:5px;">TOTAL SCORE</div>
            <div id="r-total" style="font-size:3rem; font-weight:900; color:var(--a); line-height:1;">0</div>
            <button class="btn" style="margin-top:25px; width:100%;" onclick="location.reload()">New Mission ↺</button>
        </div>
    </div>
</div>

<div id="mod-voc" class="modal-mask" onclick="clsVoc()">
    <div class="modal-box" onclick="event.stopPropagation()">
        <button onclick="clsVoc()" style="position:absolute; top:10px; right:15px; border:none; background:none; font-size:1.5rem; cursor:pointer; color:#999;">&times;</button>
        <h2 style="color:var(--p); margin-top:0; margin-bottom:10px;" id="m-w">Word</h2>
        <div style="margin-bottom:15px;">
            <span id="m-type" style="background:#eee; padding:3px 8px; border-radius:4px; font-size:0.75rem; font-weight:bold; color:#555;">TYPE</span>
            <i class="fas fa-volume-up" style="cursor:pointer; color:var(--p); margin-left:10px;" onclick="speak(document.getElementById('m-w').innerText)"></i>
        </div>
        <p style="font-style:italic; color:#555; margin-bottom:15px; font-size:0.95rem;" id="m-def">Def...</p>
        <p style="border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px;"><strong>CN:</strong> <span id="m-cn" class="blur-txt" onclick="this.classList.add('revealed')">CN</span></p>
        <div style="background:#FFF7ED; padding:12px; border-radius:10px; margin-bottom:10px;">
            <div style="font-size:0.7rem; font-weight:800; color:var(--p); margin-bottom:5px;">VIDEO CONTEXT</div>
            <div style="margin-bottom:5px; font-size:0.9rem;">"<span id="m-vex"></span>" <i class="fas fa-volume-up" style="color:var(--p); font-size:0.8rem;" onclick="speak(document.getElementById('m-vex').innerText)"></i></div>
            <div id="m-vcn" class="blur-txt" style="font-size:0.9rem;" onclick="this.classList.add('revealed')">CN</div>
        </div>
        <div style="background:#F0FDF4; padding:12px; border-radius:10px;">
            <div style="font-size:0.7rem; font-weight:800; color:#166534; margin-bottom:5px;">REAL LIFE</div>
            <div style="margin-bottom:5px; font-size:0.9rem;">"<span id="m-lex"></span>" <i class="fas fa-volume-up" style="color:#166534; font-size:0.8rem;" onclick="speak(document.getElementById('m-lex').innerText)"></i></div>
            <div id="m-lcn" class="blur-txt" style="font-size:0.9rem;" onclick="this.classList.add('revealed')">CN</div>
        </div>
    </div>
</div>

<div id="ds-pop">
    <div style="background:var(--p); color:white; padding:8px 15px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; border-radius: 12px 12px 0 0;">
        <span style="font-size:0.9rem;"><i class="fas fa-robot"></i> AI Helper</span>
        <span onclick="document.getElementById('ds-pop').style.display='none'" style="cursor:pointer; font-size:1.2rem;">&times;</span>
    </div>
    <div id="ds-con" style="padding:15px; max-height:200px; overflow-y:auto; font-size:0.95rem;">Thinking...</div>
</div>

<script>
    /* 数据对象保持不变，确保内容完整性 */
    const D = {"config": {"title": "The Great Race: Origin of the Chinese Zodiac", "theme": {"primary": "#C026D3", "accent": "#FACC15", "bg_start": "#ECFDF5", "bg_end": "#F1F5F9"}, "quizTiers": [{"percent": 0.3, "base": 30, "label": "Beginner"}, {"percent": 0.5, "base": 60, "label": "Intermediate"}, {"percent": 0.8, "base": 100, "label": "Advanced"}, {"percent": 1.0, "base": 140, "label": "Expert"}], "videoFile": "Video.mp4", "azureKey": "DKRXk8ueSfo5NdIOMqFRTCAfpeGDezJ3Snf5K8gGgtyqxiWdugLzJQQJ99BLACHYHv6XJ3w3AAAYACOGUYP9", "azureRegion": "eastus2", "deepseekKey": "sk-daa16008e81843deba6fefe9dce51465", "ai_design": {"theme": {"primary": "#F2C94C", "accent": "#E67E22", "bg_body": "#F9F5F0", "bg_card": "#FFFFFF", "text_main": "#333333", "text_sub": "#777777"}, "fonts": {"heading": "Noto Serif SC", "body": "Roboto"}, "style": {"radius": "12px", "shadow": "0 4px 20px rgba(0,0,0,0.1)"}}}, "reading": [{"text": "The Chinese Zodiac, or Shengxiao, assigns an animal (Shu xiang) to each birth year based on the Great Race myth. The Jade Emperor organized a race for animals to cross a river, with the first 12 earning a spot on the Zodiac calendar in order of arrival."}, {"text": "The Rat cleverly secured first place by riding on the Ox and jumping off at the last moment. The Ox and Tiger followed. Other animals, including the Rabbit, Dragon, Horse, Snake, Sheep, Monkey, Rooster, Dog, and Pig, each arrived in their respective order, shaping the Zodiac sequence."}, {"text": "The Chinese calendar combines the 12 Earthly Branches (animals) with the 10 Heavenly Stems (five elements in Yin and Yang), creating a 60-year cycle. Each year is associated with an animal and an element (e.g., Yang Metal Monkey, Fire Pig). Variations exist in other Asian cultures like Vietnam (Cat instead of Rabbit) and Thailand (Naga instead of Dragon)."}], "images": [{"prompt": "The Jade Emperor announcing the Great Race to the animals.", "src": "Video_Homework_img_1.jpg"}, {"prompt": "The Rat jumping off the Ox's head to win the race.", "src": "Video_Homework_img_2.jpg"}, {"prompt": "A raft carrying the Sheep, Monkey, and Rooster across the river.", "src": "Video_Homework_img_3.jpg"}, {"prompt": "The 12 animals of the Chinese Zodiac in their designated order.", "src": "Video_Homework_img_4.jpg"}], "vocab": [{"id": 0, "w": "constellation", "type": "general", "en_def": "A group of stars forming a recognizable pattern that is traditionally named after its apparent form or identified with a mythological figure.", "cn": "\u661f\u5ea7", "vid_ex": "In Western astrology, a sign is a constellation determined by when your birthday falls in the calendar.", "vid_cn": "\u5728\u897f\u65b9\u5360\u661f\u672f\u4e2d\uff0c\u661f\u5ea7\u662f\u7531\u4f60\u7684\u751f\u65e5\u5728\u65e5\u5386\u4e0a\u7684\u65e5\u671f\u51b3\u5b9a\u7684\u3002", "life_ex": "The night sky was filled with a breathtaking array of constellations.", "life_cn": "\u591c\u7a7a\u4e2d\u5e03\u6ee1\u4e86\u4ee4\u4eba\u53f9\u4e3a\u89c2\u6b62\u7684\u661f\u5ea7\u3002"}, {"id": 1, "w": "assigned", "type": "general", "en_def": "To give someone a particular job or task.", "cn": "\u5206\u914d", "vid_ex": "The Chinese Zodiac is your Shu xiang, meaning the animal assigned to your birth year.", "vid_cn": "\u4e2d\u56fd\u7684\u751f\u8096\u662f\u4f60\u7684\u5c5e\u76f8\uff0c\u6307\u7684\u662f\u5206\u914d\u7ed9\u4f60\u7684\u51fa\u751f\u5e74\u4efd\u7684\u52a8\u7269\u3002", "life_ex": "Each student was assigned a different chapter to read for the book club.", "life_cn": "\u6bcf\u4e2a\u5b66\u751f\u90fd\u88ab\u5206\u914d\u9605\u8bfb\u8bfb\u4e66\u4ff1\u4e50\u90e8\u7684\u4e0d\u540c\u7ae0\u8282\u3002"}, {"id": 2, "w": "enduring", "type": "general", "en_def": "Lasting over a period of time; durable.", "cn": "\u6301\u4e45\u7684", "vid_ex": "Of the many myths explaining these animal signs, the most enduring one is that of the Great Race.", "vid_cn": "\u5728\u89e3\u91ca\u8fd9\u4e9b\u52a8\u7269\u6807\u5fd7\u7684\u4f17\u591a\u795e\u8bdd\u4e2d\uff0c\u6700\u6301\u4e45\u7684\u4e00\u4e2a\u662f\u4f1f\u5927\u7684\u7ade\u8d5b\u3002", "life_ex": "The enduring legacy of Shakespeare continues to influence modern literature.", "life_cn": "\u838e\u58eb\u6bd4\u4e9a\u7684\u6301\u4e45\u9057\u4ea7\u7ee7\u7eed\u5f71\u54cd\u7740\u73b0\u4ee3\u6587\u5b66\u3002"}, {"id": 3, "w": "devise", "type": "general", "en_def": "To plan or invent a new way of doing something.", "cn": "\u8bbe\u8ba1", "vid_ex": "The Jade Emperor wanted to devise a way to measure time.", "vid_cn": "\u7389\u7687\u5927\u5e1d\u60f3\u8bbe\u8ba1\u4e00\u79cd\u65b9\u6cd5\u6765\u6d4b\u91cf\u65f6\u95f4\u3002", "life_ex": "Engineers had to devise a new system to improve the efficiency of the factory.", "life_cn": "\u5de5\u7a0b\u5e08\u4eec\u5fc5\u987b\u8bbe\u8ba1\u4e00\u4e2a\u65b0\u7684\u7cfb\u7edf\u6765\u63d0\u9ad8\u5de5\u5382\u7684\u6548\u7387\u3002"}, {"id": 4, "w": "earn", "type": "general", "en_def": "To get something as a result of your own efforts or abilities.", "cn": "\u6323\u5f97", "vid_ex": "The first 12 animals to make it across the river would earn a spot on the Zodiac calendar.", "vid_cn": "\u524d12\u4e2a\u8fc7\u6cb3\u7684\u52a8\u7269\u5c06\u83b7\u5f97\u5728\u751f\u8096\u65e5\u5386\u4e0a\u7684\u4f4d\u7f6e\u3002", "life_ex": "She worked hard to earn a promotion at her job.", "life_cn": "\u5979\u52aa\u529b\u5de5\u4f5c\u4ee5\u83b7\u5f97\u5de5\u4f5c\u4e0a\u7684\u664b\u5347\u3002"}, {"id": 5, "w": "secured", "type": "general", "en_def": "To obtain something, especially with effort.", "cn": "\u83b7\u5f97", "vid_ex": "The Rat jumped off the ox's head and secured first place.", "vid_cn": "\u8001\u9f20\u4ece\u725b\u7684\u5934\u4e0a\u8df3\u4e0b\u6765\uff0c\u83b7\u5f97\u4e86\u7b2c\u4e00\u540d\u3002", "life_ex": "The company secured a major contract, ensuring their financial stability.", "life_cn": "\u516c\u53f8\u83b7\u5f97\u4e86\u4e00\u4efd\u91cd\u8981\u7684\u5408\u540c\uff0c\u786e\u4fdd\u4e86\u4ed6\u4eec\u7684\u8d22\u52a1\u7a33\u5b9a\u3002"}, {"id": 6, "w": "battle", "type": "general", "en_def": "A fight between armies or groups of people.", "cn": "\u6218\u6597", "vid_ex": "The rabbit was too small to battle the current.", "vid_cn": "\u5154\u5b50\u592a\u5c0f\uff0c\u65e0\u6cd5\u4e0e\u6c34\u6d41\u640f\u6597\u3002", "life_ex": "The two countries engaged in a fierce battle over the disputed territory.", "life_cn": "\u4e24\u56fd\u5c31\u4e89\u8bae\u9886\u571f\u5c55\u5f00\u4e86\u6fc0\u70c8\u7684\u6218\u6597\u3002"}, {"id": 7, "w": "nimbly", "type": "general", "en_def": "In a quick and light manner.", "cn": "\u654f\u6377\u5730", "vid_ex": "The rabbit nimbly hopped across stones and logs.", "vid_cn": "\u5154\u5b50\u654f\u6377\u5730\u8df3\u8fc7\u77f3\u5934\u548c\u6728\u5934\u3002", "life_ex": "The dancer moved nimbly across the stage.", "life_cn": "\u821e\u8e48\u6f14\u5458\u654f\u6377\u5730\u5728\u821e\u53f0\u4e0a\u79fb\u52a8\u3002"}, {"id": 8, "w": "encountered", "type": "general", "en_def": "To meet someone or something unexpectedly.", "cn": "\u9047\u5230", "vid_ex": "The dragon stopped to help some creatures she had encountered on the way.", "vid_cn": "\u9f99\u505c\u4e0b\u6765\u5e2e\u52a9\u5979\u5728\u8def\u4e0a\u9047\u5230\u7684\u4e00\u4e9b\u751f\u7269\u3002", "life_ex": "While hiking in the forest, they encountered a deer.", "life_cn": "\u5728\u68ee\u6797\u91cc\u5f92\u6b65\u65c5\u884c\u65f6\uff0c\u4ed6\u4eec\u9047\u5230\u4e86\u4e00\u53ea\u9e7f\u3002"}, {"id": 9, "w": "galloping", "type": "general", "en_def": "Moving at a fast pace.", "cn": "\u98de\u5954", "vid_ex": "The horse was galloping across the river.", "vid_cn": "\u9a6c\u6b63\u5728\u98de\u5954\u8fc7\u6cb3\u3002", "life_ex": "The horse was galloping across the field.", "life_cn": "\u9a6c\u5728\u7530\u91ce\u4e0a\u98de\u5954\u3002"}, {"id": 10, "w": "slithered", "type": "general", "en_def": "To move smoothly over a surface with a twisting motion.", "cn": "\u6ed1\u52a8", "vid_ex": "The snake slithered by.", "vid_cn": "\u86c7\u6ed1\u4e86\u8fc7\u53bb\u3002", "life_ex": "The snake slithered through the grass.", "life_cn": "\u86c7\u5728\u8349\u4e1b\u4e2d\u6ed1\u52a8\u3002"}, {"id": 11, "w": "reared", "type": "general", "en_def": "To rise up on the hind legs.", "cn": "\u540e\u9000", "vid_ex": "The startled horse reared back.", "vid_cn": "\u53d7\u60ca\u7684\u9a6c\u5411\u540e\u9000\u3002", "life_ex": "The horse reared up in response to the sudden noise.", "life_cn": "\u9a6c\u56e0\u7a81\u7136\u7684\u566a\u97f3\u800c\u540e\u9000\u3002"}, {"id": 12, "w": "spotted", "type": "general", "en_def": "To see or notice someone or something, usually because it is difficult to find.", "cn": "\u53d1\u73b0", "vid_ex": "The Jade Emperor looked out at the river and spotted the sheep, the monkey, and the rooster.", "vid_cn": "\u7389\u7687\u5927\u5e1d\u671b\u7740\u6cb3\u6d41\uff0c\u53d1\u73b0\u4e86\u7ef5\u7f8a\u3001\u7334\u5b50\u548c\u516c\u9e21\u3002", "life_ex": "I spotted my friend in the crowd.", "life_cn": "\u6211\u5728\u4eba\u7fa4\u4e2d\u53d1\u73b0\u4e86\u6211\u7684\u670b\u53cb\u3002"}, {"id": 13, "w": "atop", "type": "general", "en_def": "On top of.", "cn": "\u5728...\u4e4b\u4e0a", "vid_ex": "The sheep, the monkey, and the rooster, all atop a raft.", "vid_cn": "\u7ef5\u7f8a\u3001\u7334\u5b50\u548c\u516c\u9e21\uff0c\u90fd\u5728\u6728\u7b4f\u4e0a\u3002", "life_ex": "The statue was placed atop the pedestal.", "life_cn": "\u96d5\u50cf\u88ab\u653e\u7f6e\u5728\u5e95\u5ea7\u4e0a\u3002"}, {"id": 14, "w": "comforting", "type": "general", "en_def": "Serving to alleviate a person's feelings of grief or distress.", "cn": "\u5b89\u6170\u7684", "vid_ex": "The sheep had been the most comforting.", "vid_cn": "\u7f8a\u662f\u6700\u4ee4\u4eba\u5b89\u6170\u7684\u3002", "life_ex": "She found his words very comforting.", "life_cn": "\u5979\u89c9\u5f97\u4ed6\u7684\u8bdd\u5f88\u5b89\u6170\u3002"}, {"id": 15, "w": "harmonious", "type": "general", "en_def": "Peaceful and friendly.", "cn": "\u548c\u8c10\u7684", "vid_ex": "The sheep had been the most comforting and harmonious.", "vid_cn": "\u7f8a\u662f\u6700\u4ee4\u4eba\u5b89\u6170\u548c\u548c\u8c10\u7684\u3002", "life_ex": "The harmonious blend of colors created a beautiful painting.", "life_cn": "\u548c\u8c10\u7684\u8272\u5f69\u642d\u914d\u521b\u9020\u4e86\u4e00\u5e45\u7f8e\u4e3d\u7684\u753b\u4f5c\u3002"}, {"id": 16, "w": "scrambling", "type": "general", "en_def": "Moving somewhere quickly and with difficulty.", "cn": "\u6500\u722c", "vid_ex": "Next came the dog, scrambling onto the shore.", "vid_cn": "\u63a5\u4e0b\u6765\u662f\u72d7\uff0c\u722c\u4e0a\u4e86\u5cb8\u8fb9\u3002", "life_ex": "The hikers were scrambling over the rocks.", "life_cn": "\u5f92\u6b65\u65c5\u884c\u8005\u4eec\u6b63\u5728\u6500\u722c\u5ca9\u77f3\u3002"}, {"id": 17, "w": "frolicked", "type": "general", "en_def": "To play or move about in a cheerful and lively way.", "cn": "\u5b09\u620f", "vid_ex": "He frolicked in the water for so long.", "vid_cn": "\u4ed6\u5728\u6c34\u4e2d\u5b09\u620f\u4e86\u5f88\u4e45\u3002", "life_ex": "The children frolicked in the park.", "life_cn": "\u5b69\u5b50\u4eec\u5728\u516c\u56ed\u91cc\u5b09\u620f\u3002"}, {"id": 18, "w": "managed", "type": "general", "en_def": "Succeeded in doing or dealing with something, especially with difficulty.", "cn": "\u8bbe\u6cd5", "vid_ex": "He only managed to come in 11th.", "vid_cn": "\u4ed6\u53ea\u8bbe\u6cd5\u83b7\u5f97\u4e86\u7b2c11\u540d\u3002", "life_ex": "She managed to finish the project on time.", "life_cn": "\u5979\u8bbe\u6cd5\u6309\u65f6\u5b8c\u6210\u4e86\u9879\u76ee\u3002"}, {"id": 19, "w": "waddling", "type": "general", "en_def": "To walk with short steps, swaying from side to side.", "cn": "\u6447\u6446", "vid_ex": "The pig was waddling across the finish line.", "vid_cn": "\u732a\u6447\u6447\u6446\u6446\u5730\u7a7f\u8fc7\u7ec8\u70b9\u7ebf\u3002", "life_ex": "The duck was waddling along the path.", "life_cn": "\u9e2d\u5b50\u6cbf\u7740\u5c0f\u8def\u6447\u6447\u6446\u6446\u5730\u8d70\u7740\u3002"}, {"id": 20, "w": "associated", "type": "general", "en_def": "Connected with something else.", "cn": "\u76f8\u5173\u7684", "vid_ex": "Each year is associated with one of the animals.", "vid_cn": "\u6bcf\u5e74\u90fd\u4e0e\u5176\u4e2d\u4e00\u79cd\u52a8\u7269\u76f8\u5173\u8054\u3002", "life_ex": "Stress is often associated with high blood pressure.", "life_cn": "\u538b\u529b\u901a\u5e38\u4e0e\u9ad8\u8840\u538b\u6709\u5173\u3002"}, {"id": 21, "w": "overlapping", "type": "general", "en_def": "Extend over so as to cover partly.", "cn": "\u91cd\u53e0\u7684", "vid_ex": "The traditional Chinese calendar is made-up of two overlapping systems.", "vid_cn": "\u4f20\u7edf\u7684\u4e2d\u56fd\u65e5\u5386\u7531\u4e24\u4e2a\u91cd\u53e0\u7684\u7cfb\u7edf\u7ec4\u6210\u3002", "life_ex": "The overlapping schedules made it difficult to coordinate the meeting.", "life_cn": "\u91cd\u53e0\u7684\u65f6\u95f4\u8868\u4f7f\u5f97\u534f\u8c03\u4f1a\u8bae\u53d8\u5f97\u56f0\u96be\u3002"}, {"id": 22, "w": "stems", "type": "general", "en_def": "The main body or stalk of a plant or shrub.", "cn": "\u830e", "vid_ex": "Ten Heavenly stems.", "vid_cn": "\u5341\u4e2a\u5929\u5e72\u3002", "life_ex": "The flower had a long, green stem.", "life_cn": "\u8fd9\u6735\u82b1\u6709\u4e00\u4e2a\u957f\u957f\u7684\u7eff\u8272\u830e\u3002"}, {"id": 23, "w": "classical", "type": "general", "en_def": "Relating to ancient Greek or Roman literature or art.", "cn": "\u53e4\u5178\u7684", "vid_ex": "The five classical elements.", "vid_cn": "\u4e94\u79cd\u53e4\u5178\u5143\u7d20\u3002", "life_ex": "He studied classical music at the conservatory.", "life_cn": "\u4ed6\u5728\u97f3\u4e50\u5b66\u9662\u5b66\u4e60\u53e4\u5178\u97f3\u4e50\u3002"}, {"id": 24, "w": "enshrined", "type": "general", "en_def": "To preserve or cherish (a right, tradition, or idea) as sacred.", "cn": "\u73cd\u85cf", "vid_ex": "The animals were enshrined in the Chinese Zodiac.", "vid_cn": "\u8fd9\u4e9b\u52a8\u7269\u88ab\u73cd\u85cf\u5728\u4e2d\u56fd\u751f\u8096\u4e2d\u3002", "life_ex": "The principles of justice are enshrined in the constitution.", "life_cn": "\u6b63\u4e49\u7684\u539f\u5219\u88ab\u73cd\u85cf\u5728\u5baa\u6cd5\u4e2d\u3002"}, {"id": 25, "w": "supposedly", "type": "general", "en_def": "According to what is generally believed but may not be true.", "cn": "\u636e\u79f0", "vid_ex": "It was the Great Race that supposedly determined which animals were enshrined.", "vid_cn": "\u636e\u79f0\uff0c\u6b63\u662f\u4f1f\u5927\u7684\u7ade\u8d5b\u51b3\u5b9a\u4e86\u54ea\u4e9b\u52a8\u7269\u88ab\u73cd\u85cf\u3002", "life_ex": "The treasure is supposedly buried on the island.", "life_cn": "\u636e\u8bf4\u5b9d\u85cf\u57cb\u85cf\u5728\u5c9b\u4e0a\u3002"}, {"id": 26, "w": "consult", "type": "general", "en_def": "Seek information or advice from (someone with expertise in a particular area).", "cn": "\u54a8\u8be2", "vid_ex": "If you consult the Vietnamese Zodiac.", "vid_cn": "\u5982\u679c\u4f60\u67e5\u9605\u8d8a\u5357\u751f\u8096\u3002", "life_ex": "You should consult a doctor if you have any concerns about your health.", "life_cn": "\u5982\u679c\u4f60\u5bf9\u81ea\u5df1\u7684\u5065\u5eb7\u6709\u4efb\u4f55\u7591\u8651\uff0c\u4f60\u5e94\u8be5\u54a8\u8be2\u533b\u751f\u3002"}, {"id": 27, "w": "mythical", "type": "general", "en_def": "Existing only in myths.", "cn": "\u795e\u8bdd\u7684", "vid_ex": "A mythical snake.", "vid_cn": "\u4e00\u6761\u795e\u8bdd\u822c\u7684\u86c7\u3002", "life_ex": "Unicorns are mythical creatures.", "life_cn": "\u72ec\u89d2\u517d\u662f\u795e\u8bdd\u751f\u7269\u3002"}, {"id": 28, "w": "replaces", "type": "general", "en_def": "To take the place of.", "cn": "\u4ee3\u66ff", "vid_ex": "A replaces the dragon.", "vid_cn": "A\u4ee3\u66ff\u4e86\u9f99\u3002", "life_ex": "The new system replaces the old one.", "life_cn": "\u65b0\u7cfb\u7edf\u4ee3\u66ff\u4e86\u65e7\u7cfb\u7edf\u3002"}, {"id": 29, "w": "stock", "type": "general", "en_def": "Believe.", "cn": "\u76f8\u4fe1", "vid_ex": "Whether or not you play stock in what the Zodiac says.", "vid_cn": "\u4f60\u662f\u5426\u76f8\u4fe1\u751f\u8096\u6240\u8bf4\u7684\u8bdd\u3002", "life_ex": "I don't put much stock in rumors.", "life_cn": "\u6211\u4e0d\u76f8\u4fe1\u8c23\u8a00\u3002"}, {"id": 30, "w": "reveals", "type": "general", "en_def": "Make (previously unknown or secret information) known to others.", "cn": "\u63ed\u793a", "vid_ex": "It certainly reveals much about the culture.", "vid_cn": "\u5b83\u5f53\u7136\u63ed\u793a\u4e86\u5f88\u591a\u5173\u4e8e\u6587\u5316\u7684\u4fe1\u606f\u3002", "life_ex": "The investigation revealed the truth about the crime.", "life_cn": "\u8c03\u67e5\u63ed\u793a\u4e86\u72af\u7f6a\u7684\u771f\u76f8\u3002"}, {"id": 31, "w": "arrangement", "type": "general", "en_def": "The way in which things are placed or organized.", "cn": "\u6392\u5217", "vid_ex": "Myths explaining these animal signs and their arrangement.", "vid_cn": "\u89e3\u91ca\u8fd9\u4e9b\u52a8\u7269\u6807\u5fd7\u53ca\u5176\u6392\u5217\u7684\u795e\u8bdd\u3002", "life_ex": "The flowers were arranged beautifully in the vase.", "life_cn": "\u82b1\u6735\u5728\u82b1\u74f6\u91cc\u6392\u5217\u5f97\u5f88\u6f02\u4eae\u3002"}, {"id": 32, "w": "successionary", "type": "general", "en_def": "Following in order or sequence.", "cn": "\u8fde\u7eed\u7684", "vid_ex": "Combinations known as a successionary cycle.", "vid_cn": "\u88ab\u79f0\u4e3a\u8fde\u7eed\u5faa\u73af\u7684\u7ec4\u5408\u3002", "life_ex": "The events followed a successionary pattern.", "life_cn": "\u8fd9\u4e9b\u4e8b\u4ef6\u9075\u5faa\u8fde\u7eed\u6a21\u5f0f\u3002"}, {"id": 33, "w": "reflect", "type": "general", "en_def": "Embody or represent (something) in a faithful or appropriate way.", "cn": "\u53cd\u6620", "vid_ex": "Other cultures made changes to reflect their communities.", "vid_cn": "\u5176\u4ed6\u6587\u5316\u8fdb\u884c\u4e86\u6539\u53d8\u4ee5\u53cd\u6620\u4ed6\u4eec\u7684\u793e\u533a\u3002", "life_ex": "The movie reflects the struggles of the working class.", "life_cn": "\u8fd9\u90e8\u7535\u5f71\u53cd\u6620\u4e86\u5de5\u4eba\u9636\u7ea7\u7684\u6323\u624e\u3002"}, {"id": 34, "w": "determine", "type": "general", "en_def": "To officially decide (something) as the result of research or an investigation", "cn": "\u786e\u5b9a", "vid_ex": "The Great Race that supposedly determined which animals were enshrined in the Chinese Zodiac.", "vid_cn": "\u636e\u8bf4\uff0c\u662f\u4f1f\u5927\u7684\u7ade\u8d5b\u51b3\u5b9a\u4e86\u54ea\u4e9b\u52a8\u7269\u88ab\u5949\u5165\u4e2d\u56fd\u5341\u4e8c\u751f\u8096\u3002", "life_ex": "Scientists are working to determine the cause of the disease.", "life_cn": "\u79d1\u5b66\u5bb6\u4eec\u6b63\u5728\u52aa\u529b\u786e\u5b9a\u75be\u75c5\u7684\u539f\u56e0\u3002"}], "quizzes": {"general": [{"time": 23.94, "type": "choice", "q": "According to the transcript, what is 'Shengxiao' also known as?", "opts": ["The Chinese Zodiac", "Western astrology", "The Great Race", "The Zodiac calendar"], "ans": 0, "review": "According to the Chinese Zodiac, or Shengxiao, it's your Shu xiang, meaning the animal assigned to your birth year.", "replay": {"start": 16.27, "end": 23.94}}, {"time": 71.95, "type": "choice", "q": "Which animal secured first place in the Zodiac race?", "opts": ["The Tiger", "The Rat", "The Ox", "The Dragon"], "ans": 1, "review": "The Rat jumped off the ox's head and secured first place.", "replay": {"start": 65.16, "end": 71.95}}, {"time": 142.5, "type": "choice", "q": "How often does the cycle of animals in the Chinese Zodiac start over?", "opts": ["Every 12 years", "Every 24 years", "Every 60 years", "Every 120 years"], "ans": 2, "review": "Each year is associated with one of the animals in this order, with the cycle starting over every 60 years.", "replay": {"start": 134.82, "end": 142.5}}, {"time": 32.95, "type": "choice", "q": "According to the transcript, what determines which animals were enshrined in the Chinese Zodiac?", "opts": ["The Vietnamese Zodiac", "The inner animal", "The Great Race", "The Thai Zodiac"], "ans": 2, "review": "It was the Great Race that supposedly determined which animals were enshrined in the Chinese Zodiac.", "replay": {"start": 31.33, "end": 32.95}}], "detailed": [{"time": 32.95, "type": "cloze", "q": "The most enduring myth explaining the animal signs and their arrangement is that of the _____.", "opts": ["Great Race", "Jade Emperor"], "ans": 0, "review": "Of the many myths explaining these animal signs and their arrangement, the most enduring 1 is that of the Great Race, as the story goes.", "replay": {"start": 23.94, "end": 32.95}}, {"time": 38.48, "type": "cloze", "q": "The Ruler of the Heavens wanted to devise a way to measure ____.", "opts": ["time", "distance"], "ans": 0, "review": "Or Jade Emperor, Ruler of the Heavens, wanted to devise a way to measure time.", "replay": {"start": 33.92, "end": 38.48}}, {"time": 71.95, "type": "true_false", "q": "The Rat jumped off the Ox before they reached the other side of the river.", "opts": ["true", "false"], "ans": 0, "review": "Yet just as they were about to reach the other side, the Rat jumped off the ox's head and secured first place.", "replay": {"start": 65.16, "end": 71.95}}, {"time": 100.07, "type": "true_false", "q": "The snake startled the horse, causing it to rear back.", "opts": ["true", "false"], "ans": 0, "review": "The horse, galloping across the river, but just as she got across, the snake slithered by. The startled horse reared back, letting the snake sneak into sixth place.", "replay": {"start": 95.82, "end": 100.07}}, {"time": 134.03, "type": "cloze", "q": "The final spot in the Zodiac race was claimed by the ____.", "opts": ["pig", "dog"], "ans": 0, "review": "The final spot was claimed by the pig, who had gotten hungry and stopped to eat and nap before finally waddling across the finish line.", "replay": {"start": 127.07, "end": 134.03}}, {"time": 148.89, "type": "choice", "q": "The traditional Chinese calendar is made up of how many overlapping systems?", "opts": ["Two", "Three", "Four", "Five"], "ans": 0, "review": "Well, the traditional Chinese calendar is made-up of two overlapping systems.", "replay": {"start": 143.71, "end": 148.89}}, {"time": 210.67, "type": "true_false", "q": "You can only have one animal sign, based on your birth year.", "opts": ["true", "false"], "ans": 1, "review": "In fact, you can also have an inner animal based on your birth month, a true animal based on your birth date, and a secret animal based on your birth hour.", "replay": {"start": 199.03, "end": 210.67}}, {"time": 227.93, "type": "choice", "q": "In the Vietnamese Zodiac, which animal replaces the rabbit?", "opts": ["Dog", "Cat", "Dragon", "Snake"], "ans": 1, "review": "So if you consult the Vietnamese Zodiac, you may discover that you're a cat, not a rabbit.", "replay": {"start": 222.83, "end": 227.93}}]}, "subtitles": [{"s": 8.87, "e": 9.96, "t": "What's your sign?"}, {"s": 9.96, "e": 16.27, "t": "In Western astrology, it's a constellation determined by when your birthday falls in the calendar."}, {"s": 16.27, "e": 23.94, "t": "But according to the Chinese Zodiac, or Shengxiao, it's your Shu xiang, meaning the animal assigned to your birth year."}, {"s": 23.94, "e": 32.95, "t": "And of the many myths explaining these animal signs and their arrangement, the most enduring 1 is that of the Great Race, as the story goes."}, {"s": 33.92, "e": 38.48, "t": "Or Jade Emperor, Ruler of the Heavens, wanted to devise a way to measure time."}, {"s": 39.19, "e": 40.57, "t": "So he organized a race."}, {"s": 40.57, "e": 45.86, "t": "The 1st 12 animals to make it across the river would earn a spot on the Zodiac calendar."}, {"s": 45.86, "e": 54.46, "t": "In the order they arrived, the Rat rose with the sun to get an early start, but on the way to the river he met the horse, the Tiger and the Ox."}, {"s": 54.46, "e": 59.99, "t": "Because the Rat was small and couldn't swim very well, he asked the bigger animals for help."}, {"s": 59.99, "e": 65.16, "t": "While the Tiger and Horse refused, the kind hearted Ox agreed to carry the Rat across."}, {"s": 65.16, "e": 68.83, "t": "Yet just as they were about to reach the other side, the Rat."}, {"s": 68.95, "e": 71.95, "t": "Jumped off the ox's head and secured first place."}, {"s": 73.07, "e": 76.79, "t": "The ox came in second, with the powerful tiger right behind him."}, {"s": 76.79, "e": 82.44, "t": "The rabbit, too small to battle the current, nimbly hopped across stones and logs to come in 4th."}, {"s": 82.44, "e": 89.71, "t": "Next came the dragon, who could have flown directly across but stopped to help some creatures she had encountered on the way."}, {"s": 89.71, "e": 95.82, "t": "After her came the horse, galloping across the river, but just as she got across, the snake slithered by."}, {"s": 95.82, "e": 100.07, "t": "The startled horse reared back, letting the snake sneak into sixth place."}, {"s": 100.55, "e": 109.02, "t": "The Jade Emperor looked out at the river and spotted the sheep, the monkey, and the rooster, all atop a raft working together to push it through the weeds."}, {"s": 109.02, "e": 118.31, "t": "When they made it across, the trio agreed to give 8th place to the sheep, who had been the most comforting and harmonious of them, followed by the monkey and the rooster."}, {"s": 118.31, "e": 120.77, "t": "Next came the dog, scrambling onto the shore."}, {"s": 120.77, "e": 126.23, "t": "He was a great swimmer, but frolicked in the water for so long that he only managed to come in 11th."}, {"s": 127.07, "e": 134.03, "t": "The final spot was claimed by the pig, who had gotten hungry and stopped to eat and nap before finally waddling across the finish line."}, {"s": 134.82, "e": 142.5, "t": "And so each year is associated with one of the animals in this order, with the cycle starting over every 60 years."}, {"s": 142.5, "e": 143.71, "t": "Why 60 and not 12?"}, {"s": 143.71, "e": 148.89, "t": "Well, the traditional Chinese calendar is made-up of two overlapping systems."}, {"s": 148.89, "e": 154.82, "t": "The animals of the Zodiac are associated with what's called the 12 Earthly branches, or."}, {"s": 156.75, "e": 169.22, "t": "Another system that 10 Heavenly stems or Shi Tiangan, is linked with the five classical elements of Metal, Jin, wood, MU, Water, Shui, Fire, huo, and Earth tu."}, {"s": 169.22, "e": 174.16, "t": "Each element is assigned yin or Yang, creating a 10 year cycle."}, {"s": 174.16, "e": 186.71, "t": "When the 12 animals of the earthly branches are matched with the five elements plus the yin or the Yang of the heavenly stems, it creates 60 years of different."}, {"s": 186.87, "e": 199.03, "t": "Combinations known as a successionary cycle or so Someone born in 1980 would have the sign of Young Metal monkey, while someone born in 2007 would be in Fire pig."}, {"s": 199.03, "e": 210.67, "t": "In fact, you can also have an inner animal based on your birth month, a true animal based on your birth date, and a secret animal based on your birth hour."}, {"s": 211.71, "e": 217.38, "t": "It was the Great Race that supposedly determined which animals were enshrined in the Chinese Zodiac."}, {"s": 217.38, "e": 222.83, "t": "But as the system spread through Asia, other cultures made changes to reflect their communities."}, {"s": 222.83, "e": 227.93, "t": "So if you consult the Vietnamese Zodiac, you may discover that you're a cat, not a rabbit."}, {"s": 227.93, "e": 232.41, "t": "And if you're in Thailand, a mythical snake called a not a replaces the dragon."}, {"s": 232.41, "e": 240.52, "t": "So whether or not you play stock in what the Zodiac says about you as an individual, it certainly reveals much about the culture it comes from."}, {"s": 249.92, "e": 262.64, "t": ""}]};

    const C = D.config;
    const AZ_KEY = "DKRXk8ueSfo5NdIOMqFRTCAfpeGDezJ3Snf5K8gGgtyqxiWdugLzJQQJ99BLACHYHv6XJ3w3AAAYACOGUYP9";
    const AZ_REG = "eastus2";
    let s = { u:"", score:0, lsc:0, qsc:0, vidsc:0, sv:new Set(), lrn:new Set(), pg:'p1', lock:false, t:0 };
    const STORAGE_KEY = 'vt_course_final_v4_mobile_fix';

    window.onload = () => {
        const hasSave = localStorage.getItem(STORAGE_KEY);
        if(hasSave) {
            const btnMain = document.getElementById('resume-btn-main');
            const btnHead = document.getElementById('resume-btn-head');
            if(btnMain) btnMain.style.display = 'inline-block';
            if(btnHead) btnHead.style.display = 'inline-block';
        }
        initSubs();
        genVocabGrid();
    };
    
    // Auto-Save
    window.addEventListener('beforeunload', () => saveState(false));
    document.addEventListener('visibilitychange', () => { if(document.visibilityState === 'hidden') saveState(false); });

    function startApp() { s.u = document.getElementById('username').value; toPage('p2'); }
    
    function resumeApp() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if(!raw) return;
            const saved = JSON.parse(raw);
            
            // Restore State
            s = {...s, ...saved, sv: new Set(saved.sv), lrn: new Set(saved.lrn)};
            if(s.u) document.getElementById('username').value = s.u;
            upUI();
            
            // UI Restore
            s.lrn.forEach(i => document.getElementById(`vc-${i}`)?.classList.add('learned'));
            toPage(s.pg);
            
            // Video Resume Logic
            if(s.pg === 'p5') {
                const vid = document.getElementById('vid1');
                const t = s.t || 0;
                if(vid.readyState >= 1) vid.currentTime = t;
                else vid.onloadedmetadata = () => { vid.currentTime = t; };
            }
        } catch(e){ console.error(e); }
    }

    function toPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        s.pg = id; 
        saveState();
        if(id === 'p5') initVid(1);
        if(id === 'p7') genReport();
    }

    function genVocabGrid() {
        const grid = document.getElementById('v-grid');
        if(!D.vocab || D.vocab.length === 0) {
            grid.innerHTML = "<p>No vocabulary loaded.</p>";
            return;
        }
        grid.innerHTML = D.vocab.map((v,i) => `
            <div class="flashcard" id="vc-${i}" onclick="openVoc(${i})">
                <div style="background:#eee; padding:2px 6px; border-radius:4px; font-size:0.7rem; font-weight:bold; color:#666; margin-bottom:10px; text-transform:uppercase;">${v.type}</div>
                <div style="font-size:1.2rem; font-weight:800; margin-bottom:10px;">${v.w}</div>
                <div style="color:var(--sub); font-size:0.85rem; line-height:1.4;">${v.en_def.substring(0,30)}...</div>
            </div>
        `).join('');
    }
    
    function openVoc(i) {
        const v = D.vocab[i];
        document.getElementById('mod-voc').style.display = 'flex';
        document.getElementById('m-w').innerText = v.w;
        document.getElementById('m-def').innerText = v.en_def;
        document.getElementById('m-cn').innerText = v.cn;
        document.getElementById('m-vex').innerText = v.vid_ex;
        document.getElementById('m-vcn').innerText = v.vid_cn;
        document.getElementById('m-lex').innerText = v.life_ex;
        document.getElementById('m-lcn').innerText = v.life_cn;
        document.querySelectorAll('.blur-txt').forEach(e => e.classList.remove('revealed'));
        speak(v.w);
        if(!s.lrn.has(i)) { s.lrn.add(i); s.lsc+=2; upUI(); saveState(); document.getElementById(`vc-${i}`).classList.add('learned'); }
    }
    function clsVoc() { document.getElementById('mod-voc').style.display='none'; }

    // Quiz
    let qQ = [], qC = 0;
    function getDistractors(w) {
        const l = w.length;
        if(l < 3) return [w+'s', w+'e', w+'a'];
        let d1 = w.replace(w[l-1], w[l-1]+'e');
        let d2 = w.substring(0, l-1);
        let d3 = w.replace(w[0], String.fromCharCode(w.charCodeAt(0)+1));
        return [d1, d2, d3];
    }

    function startQuiz(pct, base) {
        s.qsc += base; upUI();
        const n = Math.ceil(D.vocab.length * pct);
        const pool = [...D.vocab].sort(()=>0.5-Math.random()).slice(0,n);
        qQ = pool.map(v => {
            const rand = Math.random();
            let type = 'def', txt = v.en_def, opts = [];
            if(rand < 0.33) {
                type = 'spell';
                txt = `<div style='text-align:center; padding:15px;'><button class='btn btn-outline' style='font-size:1.2rem; padding:15px;' onclick="speak('${v.w}')"><i class='fas fa-volume-up'></i> Listen</button></div>`;
                opts = [v.w, ...getDistractors(v.w)].sort(()=>0.5-Math.random());
            } else if(rand < 0.66) {
                type = 'def';
                opts = [v, ...D.vocab.filter(x=>x.id!==v.id).sort(()=>0.5-Math.random()).slice(0,3)].map(x=>x.w).sort(()=>0.5-Math.random());
            } else {
                type = 'cloze';
                txt = `"${v.life_ex.replace(new RegExp(v.w, 'gi'), '_____')}"`;
                opts = [v, ...D.vocab.filter(x=>x.id!==v.id).sort(()=>0.5-Math.random()).slice(0,3)].map(x=>x.w).sort(()=>0.5-Math.random());
            }
            const review = `
                <div style="text-align:left;">
                    <h3 style="margin:0; color:var(--p); font-size:1rem;">${v.w}</h3>
                    <p style="margin:5px 0; font-size:0.9rem;"><strong>${v.cn}</strong>: ${v.en_def}</p>
                    <p style="background:#f0fdf4; padding:5px; color:#166534; font-size:0.85rem; border-radius:5px;">Ex: ${v.life_ex}</p>
                </div>
            `;
            return { txt: txt, opts: opts, ans: v.w, rev: review };
        });
        qC = 0;
        document.getElementById('qz-setup').style.display='none';
        document.getElementById('qz-run').style.display='block';
        rendQ();
    }

    function rendQ() {
        if(qC >= qQ.length) { alert("Quiz Complete!"); toPage('p5'); return; }
        const q = qQ[qC];
        document.getElementById('q-idx').innerText = qC + 1;
        document.getElementById('q-fb').style.display = 'none';
        document.getElementById('q-nxt').style.display = 'none';
        let h = `<div style="font-size:1.1rem; margin-bottom:15px; font-weight:500;">${q.txt}</div>`;
        q.opts.forEach(o => {
            h += `<button class="opt-btn" onclick="chkQ(this, '${o}', '${q.ans}')">${o}</button>`;
        });
        document.getElementById('q-content').innerHTML = h;
    }

    function chkQ(btn, sel, ans) {
        const q = qQ[qC];
        document.querySelectorAll('#q-content .opt-btn').forEach(b => b.disabled = true);
        if(sel === ans) {
            btn.classList.add('correct'); s.qsc += 2;
            document.getElementById('q-fb').innerHTML = `<strong style="color:green; font-size:1rem;">Correct!</strong><br>${q.rev}`;
        } else {
            btn.classList.add('wrong'); s.qsc -= 1;
            document.getElementById('q-fb').innerHTML = `<strong style="color:red; font-size:1rem;">Incorrect.</strong><br>${q.rev}`;
        }
        document.getElementById('q-fb').style.display = 'block';
        document.getElementById('q-nxt').style.display = 'block';
        upUI(); saveState();
    }
    function nextQ() { qC++; rendQ(); }

    // Video Logic (Enhanced for Mobile)
    let curQ = null, qIdx = 0, logs = [];
    function initVid(id) {
        const v = document.getElementById('vid1');
        const qs = D.quizzes.general;
        
        // Fast forward logic for Resume
        const startT = s.t || 0;
        qIdx = 0;
        while(qIdx < qs.length && qs[qIdx].time <= startT) {
            qIdx++;
        }
        
        document.getElementById('ol1').style.display = 'none';
        document.getElementById('rev1').style.display = 'none';
        
        if(qIdx < qs.length) {
            document.getElementById('hud').innerText = "Next Question: " + Math.floor(qs[qIdx].time) + "s";
            document.getElementById('hud').classList.add('show');
        } else {
            document.getElementById('hud').classList.remove('show');
        }

        v.ontimeupdate = () => {
            s.t = v.currentTime;
            document.getElementById('seek-bar').value = (v.currentTime / v.duration) * 100 || 0;
            
            // Highlight Subtitles
            D.subtitles.forEach((sub, i) => {
                const el = document.getElementById(`sub-${i}`);
                if(v.currentTime >= sub.s && v.currentTime <= sub.e) {
                    el.classList.add('active');
                    el.scrollIntoView({behavior: "smooth", block: "center"});
                } else {
                    el.classList.remove('active');
                }
            });

            if(qIdx < qs.length) {
                if(v.currentTime >= qs[qIdx].time && !s.lock) {
                    v.pause(); s.lock = true; popVQ(1, qs[qIdx]); qIdx++;
                    document.getElementById('hud').classList.remove('show');
                }
            }
            if(v.currentTime >= v.duration - 0.5) showRev(id);
        };
        
        v.onpause = () => saveState(false);
    }

    function popVQ(id, q) {
        curQ = q;
        document.getElementById('ol1').style.display = 'flex';
        document.getElementById('v-q').innerText = q.q;
        document.getElementById('v-fb').style.display = 'none';
        document.getElementById('btn-cont').style.display = 'none';
        document.getElementById('btn-rp').style.display = 'inline-block';
        document.getElementById('v-opts').innerHTML = q.opts.map((o,i) => 
            `<button class="opt-btn" onclick="ansV(this, ${i}, ${q.ans})">${o}</button>`
        ).join('');
    }

    function ansV(btn, idx, ans) {
        document.querySelectorAll('#v-opts .opt-btn').forEach(b => b.disabled = true);
        const isC = idx === ans;
        if(isC) { btn.classList.add('correct'); s.vidsc += 5; } else { btn.classList.add('wrong'); }
        document.getElementById('v-fb').innerHTML = `<div style="font-weight:bold;">${isC?'✅ Correct':'❌ Incorrect'}</div><small style="display:block; margin-top:5px; color:#555;">${curQ.review}</small>`;
        document.getElementById('v-fb').style.display = 'block';
        document.getElementById('btn-cont').style.display = 'inline-block';
        document.getElementById('btn-rp').style.display = 'none';
        logs.push({q:curQ.q, c:isC, a: curQ.opts[ans], r: curQ.review});
        upUI(); saveState();
    }

    function replaySeg() {
        const v = document.getElementById('vid1');
        v.currentTime = curQ.replay.start;
        document.getElementById('ol1').style.display = 'none';
        s.lock = false;
        if(qIdx > 0) qIdx--; 
        document.getElementById('hud').innerText = "Replaying...";
        document.getElementById('hud').classList.add('show');
        v.play();
    }
    
    function resumeVid() {
        document.getElementById('ol1').style.display = 'none';
        s.lock = false;
        const qs = D.quizzes.general;
        if(qIdx < qs.length) {
            document.getElementById('hud').innerText = "Next Question incoming...";
            document.getElementById('hud').classList.add('show');
        }
        document.getElementById('vid1').play();
    }

    function showRev(id) {
        document.getElementById('rev1').style.display = 'flex';
        document.getElementById('rev-list').innerHTML = logs.map(l => `
            <div style="padding:10px; background:#f9f9f9; border-radius:8px; margin-bottom:8px; border-left:4px solid ${l.c?'green':'red'}; text-align:left;">
                <div style="font-weight:bold; font-size:0.9rem; margin-bottom:3px;">${l.q}</div>
                <div style="font-size:0.8rem; color:#666;">Correct: ${l.a}</div>
            </div>
        `).join('');
    }

    function togglePlay() { const v = document.getElementById('vid1'); v.paused ? v.play() : v.pause(); }
    function upUI() { document.querySelectorAll('#u-score').forEach(e => e.innerText = s.lsc + s.qsc + s.vidsc); }
    function saveState(a) { localStorage.setItem(STORAGE_KEY, JSON.stringify({...s, sv:[...s.sv], lrn:[...s.lrn]})); if(a) alert("Progress Saved!"); }
    function genReport() { document.getElementById('r-total').innerText = s.lsc + s.qsc + s.vidsc; }
    
    function initSubs() {
        const c = document.getElementById('sub-list');
        if(!D.subtitles) return;
        D.subtitles.forEach((x,i) => {
            const d = document.createElement('div'); d.className = 'sub-line'; d.id = `sub-${i}`;
            const html = x.t.split(' ').map(w => `<span class="w-click" onclick="ds('${w.replace(/[^a-zA-Z]/g,'')}')">${w}</span>`).join(' ');
            d.innerHTML = `<small style="color:var(--sub); margin-right:8px; font-family:monospace;">${Math.floor(x.s/60)}:${Math.floor(x.s%60).toString().padStart(2,'0')}</small>${html}`;
            c.appendChild(d);
        });
    }

    async function ds(w) {
        if(!w) return;
        document.getElementById('ds-pop').style.display = 'block';
        document.getElementById('ds-con').innerHTML = 'Thinking... <i class="fas fa-spinner fa-spin"></i>';
        try {
            // Using a simple mock response for demo since key might be limited, 
            // strictly per user request I keep logic but ensure fallback if key fails
            const r = await fetch("https://api.deepseek.com/v1/chat/completions", {
                method: "POST", headers: {"Content-Type": "application/json", "Authorization": `Bearer ${C.deepseekKey}`},
                body: JSON.stringify({model: "deepseek-chat", messages: [{role: "user", content: `Define "${w}" simply. JSON: {cn, en}`}], response_format:{type:"json_object"}})
            });
            const d = JSON.parse((await r.json()).choices[0].message.content);
            document.getElementById('ds-con').innerHTML = `<strong style="font-size:1.1rem; color:var(--p);">${w}</strong><br>${d.cn}<br><small style="color:#666;">${d.en}</small>`;
        } catch(e) { 
            // Fallback lookup from vocab list if API fails
            const local = D.vocab.find(v => v.w.toLowerCase() === w.toLowerCase());
            if(local) {
                document.getElementById('ds-con').innerHTML = `<strong>${w}</strong><br>${local.cn}<br><small>${local.en_def}</small>`;
            } else {
                document.getElementById('ds-con').innerText = "Definition unavailable offline."; 
            }
        }
    }

    function speak(t) {
        if(window.SpeechSDK && AZ_KEY) {
            try {
                const c = SpeechSDK.SpeechConfig.fromSubscription(AZ_KEY, AZ_REG);
                c.speechSynthesisVoiceName = "en-GB-RyanNeural";
                const s = new SpeechSDK.SpeechSynthesizer(c);
                s.speakTextAsync(t);
            } catch(e) { console.log("Azure fail, fallback"); window.speechSynthesis.speak(new SpeechSynthesisUtterance(t)); }
        } else { const u = new SpeechSynthesisUtterance(t); window.speechSynthesis.speak(u); }
    }

    let si = 0;
    function slide(d) {
        const imgs = document.querySelectorAll('.slide-img');
        imgs[si].style.display = 'none';
        si = (si + d + imgs.length) % imgs.length;
        imgs[si].style.display = 'block';
    }
    function nextPhase() { toPage('p7'); }
</script>
</body>
</html>