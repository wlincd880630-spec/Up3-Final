<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Word Study: Adventure (Content Restored)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>

    <style>
        /* ================= Âü∫Á°ÄËÆæÁΩÆ ================= */
        :root { 
            --bg-gradient: radial-gradient(circle at center, #2c3e50 0%, #000000 100%);
            --primary: #e67e22;   /* Adventure Orange */
            --secondary: #27ae60; /* Jungle Green */
            --accent: #f1c40f;    /* Gold */
            --text-dark: #2d3436;
            --text-light: #636e72;
            --card-bg: #ffffff;
            --shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        html, body {
            margin: 0; padding: 0;
            font-family: 'Nunito', sans-serif; 
            background: var(--bg-gradient);
            /* ÊâãÊú∫Á´ØÊ†∏ÂøÉÔºöÂÖÅËÆ∏ÊªöÂä®Ôºå‰ΩøÁî®dvhÈÄÇÈÖçiOS */
            min-height: 100dvh;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            display: flex; justify-content: center; align-items: flex-start;
            padding: 20px 0;
        }

        /* --- Home ÊåâÈíÆ --- */
        .home-btn {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            background: rgba(255,255,255,0.2); color: white;
            padding: 8px 16px; border-radius: 50px; text-decoration: none;
            font-weight: 700; border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(5px); font-size: 0.9rem;
            display: flex; align-items: center; gap: 6px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* --- ‰∏ªÂÆπÂô® --- */
        #app-container {
            width: 95vw; max-width: 1400px;
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: var(--shadow);
            position: relative;
            /* Ê°åÈù¢Á´ØÈ´òÂ∫¶ */
            height: auto; min-height: 600px;
            overflow: hidden; 
            display: flex; flex-direction: column;
            margin-bottom: 40px;
        }

        /* --- Âú∫ÊôØ --- */
        .scene {
            position: relative; inset: 0;
            display: none; flex-direction: column;
            padding: 40px; box-sizing: border-box;
            background: #fdfdfd;
            opacity: 0; transition: opacity 0.4s ease;
            min-height: 600px;
        }
        .scene.active { display: flex; opacity: 1; z-index: 10; }

        /* ================= Âú∫ÊôØ 1: ÊãºÂÜô ================= */
        .mapping-layout { display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100%; width: 100%; }
        
        .sound-container { display: flex; gap: 8px; margin: 30px 0; justify-content: center; flex-wrap: wrap; }
        .sound-box-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; margin-bottom: 10px; }
        
        .sound-input {
            width: 70px; height: 90px; font-size: 2.5rem; text-align: center; font-family: 'Fredoka', sans-serif;
            border: none; border-radius: 12px; background: #ecf0f1; outline: none; 
            text-transform: lowercase; color: var(--text-dark); box-shadow: 0 6px 0 #bdc3c7;
        }
        .sound-input:focus { background: white; box-shadow: 0 6px 0 var(--primary); color: var(--primary); }
        .sound-input.correct { background: #dcfce7; color: var(--secondary); box-shadow: 0 6px 0 var(--secondary); }
        .sound-input.wrong { background: #fadbd8; color: #c0392b; box-shadow: 0 6px 0 #c0392b; animation: shake 0.4s; }
        .sound-input.long { width: 120px; background: #fffbe6; box-shadow: 0 6px 0 #f1c40f; } 
        
        .hint-label { position: absolute; top: -25px; font-size: 0.8rem; font-weight: 800; color: var(--text-light); text-transform: uppercase; }
        
        /* ================= Âú∫ÊôØ 2: ÊïÖ‰∫ã ================= */
        .comic-container { display: flex; flex-direction: column; height: 100%; gap: 20px; }
        .comic-viewport {
            flex: 2; background: #2d3436; border-radius: 20px; position: relative; overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5); min-height: 300px;
        }
        .comic-img { height: 100%; width: 100%; object-fit: cover; clip-path: inset(0 66.6% 0 0); transition: clip-path 1.2s cubic-bezier(0.25, 1, 0.5, 1); }
        .interaction-area {
            flex: 1; background: white; border-top: 6px solid var(--primary); padding: 20px 40px; border-radius: 20px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .question-text { font-size: 1.4rem; color: var(--primary); font-weight: 800; margin-bottom: 15px; display: none; animation: slideUp 0.5s forwards; }
        .answer-card {
            background: #f8fafc; padding: 20px 30px; border-radius: 16px; border-left: 6px solid var(--secondary);
            text-align: left; width: 100%; margin-bottom: 15px; display: none; position: relative;
            box-sizing: border-box;
        }
        .answer-text { font-size: 1.1rem; color: var(--text-dark); line-height: 1.6; padding-right: 35px; }

        /* ================= Âú∫ÊôØ 3: ÁøªÁâå ================= */
        .char-layout { display: flex; flex-direction: column; align-items: center; min-height: 100%; }
        .char-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 100%; max-width: 1100px; padding-bottom: 40px; }
        .mystery-card {
            background: white; border-radius: 16px; cursor: pointer; position: relative; perspective: 1000px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05); border: 2px solid #f1f2f6;
            height: auto; min-height: 180px; /* ÊÅ¢Â§çÈ´òÂ∫¶‰ª•ÂÆπÁ∫≥ÊñáÂ≠ó */
        }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; min-height: 180px; }
        .mystery-card.revealed .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute; inset: 0; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 16px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px;
        }
        .card-back { background: var(--primary); color: white; transform: rotateY(180deg); }
        .mystery-card.type-2 .card-back { background: var(--secondary); }
        
        .sentence-text { font-size: 0.95rem; color: #95a5a6; font-style: italic; margin-bottom: 10px; }
        .guide-question { font-size: 1.05rem; color: var(--text-dark); font-weight: 700; line-height: 1.3; }
        .keyword-text { font-size: 1.3rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }
        .card-icon { font-size: 2.2rem; margin-bottom: 5px; }

        /* ================= Âú∫ÊôØ 4: ÂÆö‰πâ‰∏éËØçÊ∫ê ================= */
        .concept-layout { display: flex; height: 100%; gap: 40px; padding-bottom: 40px; }
        .left-col, .right-col { flex: 1; display: flex; flex-direction: column; justify-content: flex-start; gap: 20px; }
        
        .def-card { background: white; padding: 25px; border-radius: 20px; border-left: 8px solid var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; }
        .word-title { font-size: 3.5rem; color: var(--primary); font-family: 'Fredoka'; margin: 0; line-height: 1; }
        
        /* ËØçÊ∫êÊ†ëÊÅ¢Â§ç */
        .etymology-box { background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 20px; padding: 25px; }
        .root-chip { background: #e0f2fe; color: #0284c7; padding: 2px 8px; border-radius: 6px; font-weight: bold; }
        .root-tree { margin-top: 15px; display: flex; flex-direction: column; gap: 10px; }
        .tree-item { display: flex; align-items: center; gap: 10px; font-size: 1rem; color: #475569; }
        .tree-icon { width: 30px; height: 30px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #cbd5e1; font-size: 0.8rem; font-weight: bold; color: var(--secondary); flex-shrink: 0; }
        
        /* ‰æãÂè• */
        .example-sent { font-size: 1.2rem; font-style: italic; color: #2d3436; margin-bottom: 10px; line-height: 1.4; transition: opacity 0.3s; padding-right: 30px; }
        .example-sent.hidden { opacity: 0; pointer-events: none; }
        .trans-cn { font-size: 1rem; color: #64748b; border-top: 1px solid #f1f2f6; padding-top: 8px; font-weight: bold; margin-top: 8px; display: block; }

        /* ÈÄöÁî®ÊåâÈíÆ */
        .btn {
            padding: 12px 30px; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 800; cursor: pointer;
            background: var(--text-dark); color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.2s;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px; margin: 5px;
        }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: var(--primary); }
        .btn-green { background: var(--secondary); }
        .btn-yellow { background: var(--accent); color: var(--text-dark); }
        .btn-icon { width: 40px; height: 40px; border-radius: 50%; background: #f1f2f6; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-light); }

        /* ================= üì± ÊâãÊú∫Á´ØÊ∑±Â∫¶ÈÄÇÈÖç (Mobile Override) ================= */
        @media (max-width: 1024px) {
            #app-container {
                width: 100vw; height: auto; min-height: 100vh;
                border-radius: 0; box-shadow: none; margin-bottom: 0;
            }

            .scene {
                position: relative; height: auto; min-height: 100vh;
                padding: 60px 20px 40px 20px;
                opacity: 1 !important; /* Èò≤Ê≠¢ÁôΩÂ±è */
            }

            /* Mapping */
            .sound-input { width: 13vw; height: 16vw; max-width: 60px; max-height: 80px; font-size: 1.8rem; }
            .sound-input.long { width: 20vw; max-width: 100px; }

            /* Story */
            .comic-container { flex-direction: column; }
            .comic-viewport { width: 100%; height: 250px; flex: none; border-radius: 15px; }
            .interaction-area { padding: 20px; border-radius: 15px; }

            /* Cards - Êîπ‰∏∫ÂçïÂàó‰ª•ÂÆπÁ∫≥ÂÆåÊï¥ÊñáÂ≠ó */
            .char-grid { grid-template-columns: 1fr; gap: 15px; }
            .mystery-card { min-height: 160px; } /* Á°Æ‰øùÊñáÂ≠ó‰∏çË¢´Êà™Êñ≠ */

            /* Definition - Êîπ‰∏∫ÂçïÂàó */
            .concept-layout { flex-direction: column; gap: 20px; }
            .word-title { font-size: 3rem; text-align: center; }
            .pronunciation { justify-content: center; }
            
            /* Buttons */
            .btn { width: 100%; box-sizing: border-box; margin: 5px 0; }
            .controls-row { width: 100%; display: flex; flex-direction: column; }
        }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        @keyframes slideUp { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }
    </style>
</head>
<body>

<a href="../../index.html" class="home-btn"><i class="fas fa-home"></i> Home</a>

<div id="app-container">

    <div class="scene active" id="scene-1">
        <div class="mapping-layout">
            <h2 style="color:var(--primary); font-family:'Fredoka'; text-align:center; font-size:2rem; margin:0 0 10px 0;">Let's build the word</h2>
            <p style="color:#7f8c8d; text-align:center; margin-bottom:20px;">Listen to the sounds and fill in the boxes.</p>
            
            <div class="sound-container">
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="a"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="d"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="v"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="e"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="n"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="t"></div>
                <div class="sound-box-wrapper">
                    <span class="hint-label">Suffix</span>
                    <input type="text" class="sound-input long" maxlength="3" data-ans="ure">
                </div>
            </div>

            <div class="controls-row">
                <button class="btn btn-primary" onclick="speak('Adventure')" style="width:auto;"><i class="fas fa-volume-up"></i> Play Word</button>
                <button class="btn btn-yellow" onclick="revealOneLetter()" style="width:auto;"><i class="fas fa-lightbulb"></i> Hint</button>
            </div>
            
            <button id="check-btn" class="btn btn-green" style="margin-top:20px;" onclick="checkSpelling()">Check Spelling</button>
            <button id="next-scene-btn" class="btn btn-primary" style="margin-top:20px; display:none;" onclick="startStoryScene()">Continue to Story <i class="fas fa-arrow-right"></i></button>

            <p id="feedback-msg" style="text-align:center; height:30px; font-weight:800; font-size:1.2rem; margin-top:15px; color:var(--text-dark);"></p>
        </div>
    </div>

    <div class="scene" id="scene-2">
        <div class="comic-container">
            <div class="comic-viewport">
                <img src="adventure_01.jpg" id="comic-img" class="comic-img" alt="Adventure Comic" onerror="this.onerror=null; this.parentElement.style.background='#2d3436 url(https://placehold.co/600x400/333/fff?text=Image+Loading...) center/cover no-repeat'; this.style.display='none';">
            </div>
            
            <div class="interaction-area">
                <div id="step1-q" class="question-text" style="display:block;">Panel 1: Look at these hikers. Do they have a plan?</div>
                <div id="step1-a" class="answer-card">
                    <div class="answer-text">
                        Yes. They have a map and backpacks. They are prepared. <br>
                        Is this an adventure yet? No, this is just a <b>planned trip</b>.
                    </div>
                    <button class="btn-icon" style="position: absolute; right: 10px; top: 10px;" onclick="speak('Yes. They have a map. They are prepared. Is this an adventure yet? No, this is just a planned trip.')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div id="step2-q" class="question-text" style="display:none;">Panel 2: Oh no! What happened to the plan?</div>
                <div id="step2-a" class="answer-card" style="border-left-color: var(--primary);">
                    <div class="answer-text">
                        They are lost! The path is gone. <br>
                        A normal "trip" follows a plan. But here, <b>something unexpected</b> has happened.
                    </div>
                    <button class="btn-icon" style="position: absolute; right: 10px; top: 10px;" onclick="speak('They are lost. The path is gone. A normal trip follows a plan. But here, something unexpected has happened.')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div id="step3-q" class="question-text" style="display:none;">Panel 3: Look at the end. Was the scary part worth it?</div>
                <div id="step3-a" class="answer-card" style="border-left-color: var(--accent);">
                    <div class="answer-text">
                        Yes! They found a secret waterfall and stars. <br>
                        This is an <b>Adventure</b>: It starts with a risk, but ends with a reward.
                    </div>
                    <button class="btn-icon" style="position: absolute; right: 10px; top: 10px;" onclick="speak('Yes! They found a secret waterfall. This is an Adventure: It starts with a risk, but ends with a reward.')"><i class="fas fa-volume-up"></i></button>
                </div>

                <button class="btn btn-primary" id="story-btn" onclick="advanceStory()">Reveal Answer</button>
            </div>
        </div>
    </div>

    <div class="scene" id="scene-3">
        <div class="char-layout">
            <h2 style="color:var(--primary); font-family:'Fredoka'; font-size:1.8rem; margin-bottom:10px; text-align:center;">What defines an Adventure?</h2>
            <p style="text-align:center; color:#7f8c8d; margin-bottom:20px;">Tap cards to reveal keywords.</p>
            
            <div class="char-grid">
                <div class="mystery-card" onclick="toggleCard(this, 'Unknown')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="sentence-text">"We didn't know where the road would go..."</div>
                            <div class="guide-question">What do you call it when you have no information?</div>
                        </div>
                        <div class="card-back"><div class="card-icon">‚ùì</div><div class="keyword-text">Unknown</div></div>
                    </div>
                </div>
                <div class="mystery-card type-2" onclick="toggleCard(this, 'Risk')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="sentence-text">"The climb was steep and dangerous."</div>
                            <div class="guide-question">What word implies a chance of danger?</div>
                        </div>
                        <div class="card-back"><div class="card-icon">‚ö†Ô∏è</div><div class="keyword-text">Risk</div></div>
                    </div>
                </div>
                <div class="mystery-card" onclick="toggleCard(this, 'Unexpected')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="sentence-text">"Suddenly, a storm started!"</div>
                            <div class="guide-question">What word describes something you didn't plan for?</div>
                        </div>
                        <div class="card-back"><div class="card-icon">‚ö°</div><div class="keyword-text">Unexpected</div></div>
                    </div>
                </div>
                <div class="mystery-card type-2" onclick="toggleCard(this, 'Discovery')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="sentence-text">"Look! We found a hidden cave."</div>
                            <div class="guide-question">What is the act of finding something new?</div>
                        </div>
                        <div class="card-back"><div class="card-icon">üíé</div><div class="keyword-text">Discovery</div></div>
                    </div>
                </div>
                <div class="mystery-card" onclick="toggleCard(this, 'Challenge')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="sentence-text">"It was very hard, but we didn't stop."</div>
                            <div class="guide-question">What do we call a task that tests your ability?</div>
                        </div>
                        <div class="card-back"><div class="card-icon">üèîÔ∏è</div><div class="keyword-text">Challenge</div></div>
                    </div>
                </div>
                <div class="mystery-card type-2" onclick="toggleCard(this, 'Excitement')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="sentence-text">"I can't wait to see what happens!"</div>
                            <div class="guide-question">What is the feeling of great enthusiasm?</div>
                        </div>
                        <div class="card-back"><div class="card-icon">üî•</div><div class="keyword-text">Excitement</div></div>
                    </div>
                </div>
            </div>

            <button class="btn btn-green" onclick="goToScene(4)">Step 4: Definition & Origin <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

    <div class="scene" id="scene-4">
        <div class="concept-layout">
            <div class="left-col">
                <h1 class="word-title">Adventure</h1>
                <div class="pronunciation">
                    /…ôdÀàv…õn.t É…ôr/ 
                    <button class="btn-icon" onclick="speak('Adventure')"><i class="fas fa-volume-up"></i></button>
                </div>
                
                <div class="def-card">
                    <h3 style="margin:0 0 10px 0; color:var(--primary);">Definition</h3>
                    <p style="font-size:1.1rem; line-height:1.4;">An unusual, exciting, and possibly dangerous activity or experience.</p>
                    <div class="controls-top" style="position: absolute; top: 15px; right: 10px;">
                        <button class="btn-icon" onclick="speak('An unusual, exciting, and possibly dangerous activity or experience.')"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>

                <div class="etymology-box">
                    <h3 style="margin:0 0 10px 0; color:#7f8c8d;">Word Origin</h3>
                    <p>Latin: <span class="root-chip">Ad-</span> (to) + <span class="root-chip">Ven</span> (come)<br> = "What comes to you" (often unexpectedly).</p>
                    
                    <div class="root-tree">
                        <div class="tree-item"><div class="tree-icon">E</div> <b>Event</b> (e- out + ven) ‚Üí A happening.</div>
                        <div class="tree-item"><div class="tree-icon">P</div> <b>Prevent</b> (pre- before + ven) ‚Üí To stop.</div>
                        <div class="tree-item"><div class="tree-icon">I</div> <b>Invent</b> (in- into + ven) ‚Üí To create.</div>
                    </div>
                </div>
            </div>

            <div class="right-col">
                <h3 style="color:var(--secondary); text-align:center;">B1 Example Sentences</h3>
                
                <div class="def-card" style="border-left-color: var(--secondary);">
                    <div class="card-header-actions">
                        <button class="btn-icon" onclick="toggleText('ex1-en')"><i class="fas fa-eye"></i></button>
                        <button class="btn-icon" onclick="speak('Our camping trip turned into a real adventure when we saw a bear!')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div id="ex1-en" class="example-sent">"Our camping trip turned into a real <b>adventure</b> when we saw a bear!"</div>
                    <div class="trans-cn">"ÂΩìÊàë‰ª¨ÁúãÂà∞ÁÜäÊó∂ÔºåÊàë‰ª¨ÁöÑÈú≤Ëê•ÊóÖË°åÂèòÊàê‰∫Ü‰∏ÄÊ¨°ÁúüÊ≠£ÁöÑÂÜíÈô©ÔºÅ"</div>
                </div>

                <div class="def-card" style="border-left-color: var(--accent);">
                    <div class="card-header-actions">
                        <button class="btn-icon" onclick="toggleText('ex2-en')"><i class="fas fa-eye"></i></button>
                        <button class="btn-icon" onclick="speak('She left her boring office job to look for adventure in a new country.')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div id="ex2-en" class="example-sent">"She left her boring office job to look for <b>adventure</b> in a new country."</div>
                    <div class="trans-cn">"Â•πËæûÂéª‰∫ÜÊó†ËÅäÁöÑÂäûÂÖ¨ÂÆ§Â∑•‰ΩúÔºåÂéª‰∏Ä‰∏™Êñ∞ÁöÑÂõΩÂÆ∂ÂØªÊâæÂÜíÈô©„ÄÇ"</div>
                </div>
                
                <button class="btn" onclick="location.reload()"><i class="fas fa-redo"></i> Replay Lesson</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- Azure Speech ---
    const azureKey = "DKRXk8ueSfo5NdIOMqFRTCAfpeGDezJ3Snf5K8gGgtyqxiWdugLzJQQJ99BLACHYHv6XJ3w3AAAYACOGUYP9";
    const azureRegion = "eastus2"; 
    let synthesizer = null;

    function speak(text) {
        if (synthesizer) { synthesizer.close(); synthesizer = null; }
        try {
            const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(azureKey, azureRegion);
            speechConfig.speechSynthesisVoiceName = "en-US-AriaNeural"; 
            const audioConfig = SpeechSDK.AudioConfig.fromDefaultSpeakerOutput();
            synthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig, audioConfig);
            synthesizer.speakTextAsync(text, res => { synthesizer.close(); }, err => { synthesizer.close(); });
        } catch (e) { console.error(e); }
    }

    // --- Navigation System (Robust) ---
    function goToScene(id) {
        document.querySelectorAll('.scene').forEach(s => {
            s.classList.remove('active');
            setTimeout(() => { if(!s.classList.contains('active')) s.style.display = 'none'; }, 400);
        });
        
        const next = document.getElementById('scene-' + id);
        next.style.display = 'flex';
        
        // Scroll to top
        window.scrollTo(0,0);
        document.getElementById('app-container').scrollTop = 0;

        setTimeout(() => {
            next.classList.add('active');
        }, 50);
    }

    function hideElements(ids) {
        ids.forEach(id => document.getElementById(id).style.display = 'none');
    }

    // --- Scene 1: Spelling ---
    const inputs = document.querySelectorAll('.sound-input');
    inputs.forEach((input, idx) => {
        input.addEventListener('input', () => {
            if(input.value.length === input.maxLength && idx < inputs.length - 1) inputs[idx+1].focus();
        });
        input.addEventListener('keydown', (e) => {
            if(e.key === 'Backspace' && input.value === '' && idx > 0) inputs[idx-1].focus();
        });
    });

    function checkSpelling() {
        let allCorrect = true;
        inputs.forEach(input => {
            if(input.value.toLowerCase() === input.dataset.ans) {
                input.classList.add('correct'); input.classList.remove('wrong');
            } else {
                input.classList.add('wrong'); input.classList.remove('correct'); allCorrect = false;
            }
        });

        const feedback = document.getElementById('feedback-msg');
        if(allCorrect) {
            feedback.innerText = "Perfect! Let's see the story.";
            feedback.style.color = "var(--secondary)";
            speak("Adventure! Perfect.");
            document.getElementById('check-btn').style.display = 'none';
            document.getElementById('next-scene-btn').style.display = 'inline-flex';
        } else {
            feedback.innerText = "Try again.";
            feedback.style.color = "#e74c3c";
            speak("Try again.");
        }
    }

    function revealOneLetter() {
        for(let input of inputs) {
            if(input.value.toLowerCase() !== input.dataset.ans) {
                input.value = input.dataset.ans;
                input.classList.add('correct'); input.classList.remove('wrong');
                speak(input.dataset.ans);
                break; 
            }
        }
    }

    function startStoryScene() {
        goToScene(2);
        initStory();
    }

    // --- Scene 2: Story (Fully Restored Text) ---
    let storyStep = 0;
    const img = document.getElementById('comic-img');
    const storyBtn = document.getElementById('story-btn');

    function initStory() {
        document.getElementById('step1-q').style.display = 'block';
    }

    function advanceStory() {
        storyStep++;
        if (storyStep === 1) { 
            document.getElementById('step1-a').style.display = 'block';
            speak("Yes. They have a map. They are prepared. Is this an adventure yet? No, this is just a planned trip.");
            storyBtn.innerText = "Show Panel 2 (The Problem)";
            storyBtn.className = "btn btn-green";
        } else if (storyStep === 2) {
            img.style.clipPath = 'inset(0 33.3% 0 0)';
            hideElements(['step1-q', 'step1-a']);
            document.getElementById('step2-q').style.display = 'block';
            storyBtn.innerText = "Reveal Answer";
            storyBtn.className = "btn"; 
        } else if (storyStep === 3) {
            document.getElementById('step2-a').style.display = 'block';
            speak("They are lost! The path is gone. A normal trip follows a plan. But here, something unexpected has happened.");
            storyBtn.innerText = "Show Panel 3 (The Discovery)";
            storyBtn.className = "btn btn-green";
        } else if (storyStep === 4) {
            img.style.clipPath = 'inset(0 0 0 0)';
            hideElements(['step2-q', 'step2-a']);
            document.getElementById('step3-q').style.display = 'block';
            storyBtn.innerText = "Reveal Conclusion";
            storyBtn.className = "btn";
        } else if (storyStep === 5) {
            document.getElementById('step3-a').style.display = 'block';
            speak("Yes! They found a secret waterfall. This is an Adventure.");
            storyBtn.innerText = "What does Adventure mean? ‚Üí";
            storyBtn.className = "btn btn-green";
        } else if (storyStep === 6) {
            goToScene(3);
        }
    }

    // --- Scene 3: Card Flip ---
    function toggleCard(card, keyword) {
        if (!card.classList.contains('revealed')) {
            card.classList.add('revealed');
            speak(keyword);
        }
    }

    // --- Scene 4: Toggle Text ---
    function toggleText(id) {
        const el = document.getElementById(id);
        el.classList.toggle('hidden');
    }
</script>

</body>
</html>