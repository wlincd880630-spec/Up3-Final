<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Word Study: Adventure (Pro V4)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>

    <style>
        /* ================= ËßÜËßâÁ≥ªÁªü ================= */
        :root { 
            --bg-gradient: radial-gradient(circle at center, #2c3e50 0%, #000000 100%);
            --primary: #e67e22;   /* Adventure Orange */
            --secondary: #27ae60; /* Jungle Green */
            --accent: #f1c40f;    /* Gold */
            --text-dark: #2d3436;
            --text-light: #636e72;
            --card-bg: #ffffff;
            --shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        body { 
            margin: 0; font-family: 'Nunito', sans-serif; height: 100vh; overflow: hidden; 
            background: var(--bg-gradient);
            display: flex; justify-content: center; align-items: center; 
            user-select: none;
        }

        /* --- Home ÊåâÈíÆ --- */
        .home-btn {
            position: fixed; top: 20px; left: 20px; z-index: 2000;
            background: rgba(255,255,255,0.15); color: white;
            padding: 8px 18px; border-radius: 50px; text-decoration: none;
            font-weight: 700; border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px); transition: 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .home-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }

        /* --- ‰∏ªÂÆπÂô® --- */
        #app-container {
            width: 95vw; height: 53.43vw; 
            max-width: 1400px; max-height: 787.5px; 
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- Âú∫ÊôØÈÄöÁî® --- */
        .scene {
            position: absolute; inset: 0;
            display: none; flex-direction: column;
            padding: 40px; box-sizing: border-box;
            opacity: 0; transition: opacity 0.5s ease;
            background: #fdfdfd;
        }
        .scene.active { display: flex; opacity: 1; }

        /* ================= Scene 1: Mapping ================= */
        .mapping-layout { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
        .sound-container { display: flex; gap: 10px; margin: 40px 0; justify-content: center; flex-wrap: wrap; }
        .sound-box-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
        .sound-input {
            width: 70px; height: 90px; font-size: 2.5rem; text-align: center; font-family: 'Fredoka', sans-serif;
            border: none; border-radius: 12px; background: #ecf0f1; outline: none; transition: 0.2s; 
            text-transform: lowercase; color: var(--text-dark); box-shadow: 0 6px 0 #bdc3c7; margin-bottom: 6px;
        }
        .sound-input:active { transform: translateY(6px); box-shadow: none; }
        .sound-input.long { width: 120px; background: #fffbe6; box-shadow: 0 6px 0 #f1c40f; } 
        .sound-input:focus { background: white; box-shadow: 0 6px 0 var(--primary); color: var(--primary); }
        .sound-input.correct { background: #dcfce7; color: var(--secondary); box-shadow: 0 6px 0 var(--secondary); pointer-events: none; }
        .sound-input.wrong { background: #fadbd8; color: #c0392b; box-shadow: 0 6px 0 #c0392b; animation: shake 0.4s; }
        .hint-label { position: absolute; top: -30px; font-size: 0.9rem; color: var(--text-light); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .controls-row { display: flex; gap: 20px; margin-top: 10px; }

        /* ================= Scene 2: Comic Story ================= */
        .comic-container { display: flex; flex-direction: column; height: 100%; gap: 20px; }
        .comic-viewport {
            flex: 2; background: #2d3436; border-radius: 20px; position: relative; overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: flex-start;
        }
        .comic-img { height: 100%; width: 100%; object-fit: cover; clip-path: inset(0 66.6% 0 0); transition: clip-path 1.2s cubic-bezier(0.25, 1, 0.5, 1); }
        .interaction-area {
            flex: 1; background: white; border-top: 6px solid var(--primary); padding: 20px 40px; border-radius: 20px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .question-text { font-size: 1.5rem; color: var(--primary); font-weight: 800; margin-bottom: 15px; display: none; animation: slideUp 0.5s forwards; }
        .answer-card {
            background: #f8fafc; padding: 20px 30px; border-radius: 16px; border-left: 6px solid var(--secondary);
            text-align: left; width: 85%; display: none; animation: fadeIn 0.5s forwards; margin-bottom: 15px; position: relative;
        }
        .answer-text { font-size: 1.2rem; color: var(--text-dark); line-height: 1.6; padding-right: 40px; }

        /* ================= Scene 3: Card Grid ================= */
        .char-layout { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
        .char-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; width: 95%; max-width: 1100px; }
        .mystery-card {
            background: white; border-radius: 16px; height: 160px; cursor: pointer; position: relative; perspective: 1000px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05); border: 2px solid #f1f2f6; transition: transform 0.3s;
        }
        .mystery-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; display: flex; align-items: center; justify-content: center; }
        .mystery-card.revealed .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute; inset: 0; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 16px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px;
        }
        .card-front { background: white; color: var(--text-dark); }
        .card-back { background: var(--primary); color: white; transform: rotateY(180deg); }
        .mystery-card.type-2 .card-back { background: var(--secondary); }
        .sentence-text { font-size: 0.95rem; color: #95a5a6; font-style: italic; margin-bottom: 8px; }
        .guide-question { font-size: 1.1rem; color: var(--text-dark); font-weight: 700; line-height: 1.3; }
        .card-icon { font-size: 2.5rem; margin-bottom: 5px; }
        .keyword-text { font-size: 1.4rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }

        /* ================= Scene 4: Etymology (Fixed Padding) ================= */
        .concept-layout { display: flex; height: 100%; gap: 40px; padding: 20px; }
        .left-col { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .right-col { flex: 1; display: flex; flex-direction: column; gap: 20px; justify-content: center; }

        .word-title { font-size: 4rem; color: var(--primary); font-weight: 900; margin: 0; font-family: 'Fredoka'; line-height: 1; }
        .pronunciation { font-size: 1.6rem; color: #b2bec3; margin-bottom: 30px; font-style: italic; font-family: serif; display: flex; align-items: center; gap: 10px; }

        .def-card {
            background: white; 
            /* Ê†∏ÂøÉ‰øÆÂ§çÔºöÂè≥‰æßÁïôÂá∫ 110px ÁªôÊåâÈíÆ */
            padding: 25px 110px 25px 25px; 
            border-radius: 20px; position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); border-left: 8px solid var(--primary); margin-bottom: 20px;
        }
        
        .etymology-box { background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 20px; padding: 25px; }
        .root-chip { background: #e0f2fe; color: #0284c7; padding: 2px 8px; border-radius: 6px; font-weight: bold; }
        
        .root-tree { margin-top: 15px; display: flex; flex-direction: column; gap: 10px; }
        .tree-item { display: flex; align-items: center; gap: 10px; font-size: 1rem; color: #475569; }
        .tree-icon { width: 30px; height: 30px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #cbd5e1; font-size: 0.8rem; font-weight: bold; color: var(--secondary); }

        /* ‰æãÂè•‰∏éÁøªËØë */
        .card-header-actions {
            position: absolute; top: 20px; right: 20px; display: flex; gap: 8px;
        }
        .example-sent { font-size: 1.3rem; font-style: italic; color: #2d3436; margin-bottom: 10px; line-height: 1.4; transition: opacity 0.3s; }
        .example-sent.hidden { opacity: 0; pointer-events: none; }
        
        .trans-cn { 
            font-size: 1.1rem; color: #64748b; margin-top: 8px; padding-top: 8px; 
            border-top: 1px solid #f1f2f6; font-weight: bold; display: block;
        }

        /* UI Elements */
        .btn {
            padding: 12px 30px; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 800; cursor: pointer;
            background: var(--text-dark); color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: all 0.2s;
            display: inline-flex; align-items: center; gap: 8px; justify-content: center;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); filter: brightness(1.1); }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); }
        .btn-green { background: var(--secondary); }
        .btn-yellow { background: var(--accent); color: var(--text-dark); }

        /* Â∞èÂúÜÂΩ¢ÊåâÈíÆ */
        .btn-icon {
            width: 40px; height: 40px; border-radius: 50%; background: #f1f2f6; border: none; color: var(--text-light);
            cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-icon:hover { background: var(--primary); color: white; transform: scale(1.1); }
        .btn-icon:active { transform: scale(0.9); background: var(--text-dark); }

        @keyframes slideUp { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        @media (max-width: 1024px) {
            #app-container { height: auto; min-height: 100vh; width: 100vw; border-radius: 0; overflow-y: auto; }
            .scene { position: relative; padding: 20px; height: auto; min-height: 100vh; }
            .comic-container, .concept-layout { flex-direction: column; }
            .comic-viewport { height: 300px; width: 100%; flex: none; }
            .char-grid { grid-template-columns: 1fr; }
            .mapping-layout { justify-content: flex-start; padding-top: 60px; }
        }
    </style>
</head>
<body>

<a href="../../index.html" class="home-btn"><i class="fas fa-home"></i> Home</a>

<div id="app-container">

    <div class="scene active" id="scene-1">
        <div class="mapping-layout">
            <h2 style="color:var(--primary); font-size:2.5rem; margin-bottom:10px; font-family:'Fredoka';">Let's build the word</h2>
            <p style="color:#7f8c8d; font-size:1.2rem; margin-bottom:30px;">Listen to the sounds and fill in the boxes.</p>
            
            <div class="controls-row">
                <button class="btn btn-primary" onclick="speak('Adventure')"><i class="fas fa-volume-up"></i> Play Word</button>
                <button class="btn btn-yellow" onclick="revealOneLetter()"><i class="fas fa-lightbulb"></i> Hint</button>
            </div>

            <div class="sound-container">
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="a"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="d"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="v"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="e"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="n"></div>
                <div class="sound-box-wrapper"><input type="text" class="sound-input" maxlength="1" data-ans="t"></div>
                <div class="sound-box-wrapper">
                    <span class="hint-label">Suffix</span>
                    <input type="text" class="sound-input long" maxlength="3" data-ans="ure">
                </div>
            </div>
            
            <button id="check-btn" class="btn btn-green" style="margin-top:20px; font-size:1.4rem; padding: 15px 50px;" onclick="checkSpelling()">Check Spelling</button>
            <button id="next-scene-btn" class="btn btn-primary" style="margin-top:20px; font-size:1.4rem; padding: 15px 50px; display:none;" onclick="startStoryScene()">Continue to Story <i class="fas fa-arrow-right"></i></button>

            <p id="feedback-msg" style="height:30px; font-weight:800; font-size:1.4rem; margin-top:20px; color:var(--text-dark);"></p>
        </div>
    </div>

    <div class="scene" id="scene-2">
        <div class="comic-container">
            <div class="comic-viewport">
                <img src="adventure_01.jpg" id="comic-img" class="comic-img" alt="Adventure Comic" onerror="this.src='https://placehold.co/1200x600/2d3436/ecf0f1?text=Adventure+Comic+Strip'">
            </div>
            
            <div class="interaction-area">
                <div id="step1-q" class="question-text">Panel 1: Look at these hikers. Do they have a plan?</div>
                <div id="step1-a" class="answer-card">
                    <div class="answer-text">
                        Yes. They have a map and backpacks. They are prepared. <br>
                        Is this an adventure yet? No, this is just a <b>planned trip</b>.
                    </div>
                    <button class="btn-icon" style="position: absolute; right: 15px; top: 15px;" onclick="speak('Yes. They have a map. They are prepared. Is this an adventure yet? No, this is just a planned trip.')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div id="step2-q" class="question-text">Panel 2: Oh no! What happened to the plan?</div>
                <div id="step2-a" class="answer-card" style="border-left-color: var(--primary);">
                    <div class="answer-text">
                        They are lost! The path is gone. <br>
                        A normal "trip" follows a plan. But here, <b>something unexpected</b> has happened.
                    </div>
                    <button class="btn-icon" style="position: absolute; right: 15px; top: 15px;" onclick="speak('They are lost. The path is gone. A normal trip follows a plan. But here, something unexpected has happened.')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div id="step3-q" class="question-text">Panel 3: Look at the end. Was the scary part worth it?</div>
                <div id="step3-a" class="answer-card" style="border-left-color: var(--accent);">
                    <div class="answer-text">
                        Yes! They found a secret waterfall and stars. <br>
                        This is an <b>Adventure</b>: It starts with a risk, but ends with a reward.
                    </div>
                    <button class="btn-icon" style="position: absolute; right: 15px; top: 15px;" onclick="speak('Yes! They found a secret waterfall. This is an Adventure: It starts with a risk, but ends with a reward.')"><i class="fas fa-volume-up"></i></button>
                </div>

                <button class="btn btn-primary" id="story-btn" onclick="advanceStory()">Reveal Answer</button>
            </div>
        </div>
    </div>

    <div class="scene" id="scene-3">
        <div class="char-layout">
            <h2 style="color:var(--primary); font-size:2.2rem; margin-bottom:5px; font-family:'Fredoka';">What defines an Adventure?</h2>
            <p style="font-size:1.2rem; color:#7f8c8d; margin-bottom:20px;">
                Read the situation. Click the card to reveal the keyword.
            </p>
            
            <div class="char-grid">
                <div class="mystery-card" onclick="toggleCard(this, 'Unknown')">
                    <div class="card-inner">
                        <div class="card-front"><div class="sentence-text">"We didn't know where the road would go..."</div><div class="guide-question">What do you call it when you have no information?</div></div>
                        <div class="card-back"><div class="card-icon">‚ùì</div><div class="keyword-text">Unknown</div></div>
                    </div>
                </div>
                <div class="mystery-card type-2" onclick="toggleCard(this, 'Risk')">
                    <div class="card-inner">
                        <div class="card-front"><div class="sentence-text">"The climb was steep and dangerous."</div><div class="guide-question">What word implies a chance of danger?</div></div>
                        <div class="card-back"><div class="card-icon">‚ö†Ô∏è</div><div class="keyword-text">Risk</div></div>
                    </div>
                </div>
                <div class="mystery-card" onclick="toggleCard(this, 'Unexpected')">
                    <div class="card-inner">
                        <div class="card-front"><div class="sentence-text">"Suddenly, a storm started!"</div><div class="guide-question">What word describes something you didn't plan for?</div></div>
                        <div class="card-back"><div class="card-icon">‚ö°</div><div class="keyword-text">Unexpected</div></div>
                    </div>
                </div>
                <div class="mystery-card type-2" onclick="toggleCard(this, 'Discovery')">
                    <div class="card-inner">
                        <div class="card-front"><div class="sentence-text">"Look! We found a hidden cave."</div><div class="guide-question">What is the act of finding something new?</div></div>
                        <div class="card-back"><div class="card-icon">üíé</div><div class="keyword-text">Discovery</div></div>
                    </div>
                </div>
                <div class="mystery-card" onclick="toggleCard(this, 'Challenge')">
                    <div class="card-inner">
                        <div class="card-front"><div class="sentence-text">"It was very hard, but we didn't stop."</div><div class="guide-question">What do we call a task that tests your ability?</div></div>
                        <div class="card-back"><div class="card-icon">üèîÔ∏è</div><div class="keyword-text">Challenge</div></div>
                    </div>
                </div>
                <div class="mystery-card type-2" onclick="toggleCard(this, 'Excitement')">
                    <div class="card-inner">
                        <div class="card-front"><div class="sentence-text">"I can't wait to see what happens!"</div><div class="guide-question">What is the feeling of great enthusiasm?</div></div>
                        <div class="card-back"><div class="card-icon">üî•</div><div class="keyword-text">Excitement</div></div>
                    </div>
                </div>
            </div>

            <button class="btn btn-green" style="margin-top:30px;" onclick="goToScene(4)">Step 4: Definition & Origin <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

    <div class="scene" id="scene-4">
        <div class="concept-layout">
            <div class="left-col">
                <h1 class="word-title">Adventure</h1>
                <div class="pronunciation">
                    /…ôdÀàv…õn.t É…ôr/ 
                    <button class="btn-icon" onclick="speak('Adventure')"><i class="fas fa-volume-up"></i></button>
                </div>
                
                <div class="def-card">
                    <h3 style="margin:0 0 10px 0; color:var(--primary);">Definition</h3>
                    <span style="font-size:1.3rem;">An unusual, exciting, and possibly dangerous activity or experience.</span>
                    <div class="controls-top" style="position: absolute; top: 15px; right: 15px;">
                        <button class="btn-icon" onclick="speak('An unusual, exciting, and possibly dangerous activity or experience.')"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>

                <div class="etymology-box">
                    <h3 style="margin:0 0 15px 0; color:#7f8c8d; border-bottom:1px solid #dcdcdc; padding-bottom:10px;">Word Origin</h3>
                    <p style="font-size:1.1rem; line-height:1.6; margin-bottom:15px;">
                        From Latin: <span class="root-chip">Ad-</span> (to) + <span class="root-chip">Ven</span> (come)<br>
                        = "What comes to you" (often unexpectedly).
                    </p>
                    <div class="root-tree">
                        <div class="tree-item"><div class="tree-icon">E</div> <b>Event</b> (e- out + ven) ‚Üí A happening.</div>
                        <div class="tree-item"><div class="tree-icon">P</div> <b>Prevent</b> (pre- before + ven) ‚Üí To stop.</div>
                        <div class="tree-item"><div class="tree-icon">I</div> <b>Invent</b> (in- into + ven) ‚Üí To create.</div>
                    </div>
                </div>
            </div>

            <div class="right-col">
                <h3 style="color:var(--secondary); border-bottom:2px solid var(--secondary); padding-bottom:5px;">B1 Example Sentences</h3>
                
                <div class="def-card" style="border-left-color: var(--secondary);">
                    <div class="card-header-actions">
                        <button class="btn-icon" onclick="toggleText('ex1-en')"><i class="fas fa-eye"></i></button>
                        <button class="btn-icon" onclick="speak('Our camping trip turned into a real adventure when we saw a bear!')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div id="ex1-en" class="example-sent">"Our camping trip turned into a real <b>adventure</b> when we saw a bear!"</div>
                    <div class="trans-cn">"ÂΩìÊàë‰ª¨ÁúãÂà∞ÁÜäÊó∂ÔºåÊàë‰ª¨ÁöÑÈú≤Ëê•ÊóÖË°åÂèòÊàê‰∫Ü‰∏ÄÊ¨°ÁúüÊ≠£ÁöÑÂÜíÈô©ÔºÅ"</div>
                </div>

                <div class="def-card" style="border-left-color: var(--accent);">
                    <div class="card-header-actions">
                        <button class="btn-icon" onclick="toggleText('ex2-en')"><i class="fas fa-eye"></i></button>
                        <button class="btn-icon" onclick="speak('She left her boring office job to look for adventure in a new country.')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div id="ex2-en" class="example-sent">"She left her boring office job to look for <b>adventure</b> in a new country."</div>
                    <div class="trans-cn">"Â•πËæûÂéª‰∫ÜÊó†ËÅäÁöÑÂäûÂÖ¨ÂÆ§Â∑•‰ΩúÔºåÂéª‰∏Ä‰∏™Êñ∞ÁöÑÂõΩÂÆ∂ÂØªÊâæÂÜíÈô©„ÄÇ"</div>
                </div>
                
                <button class="btn" style="margin-top:auto;" onclick="location.reload()"><i class="fas fa-redo"></i> Replay Lesson</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- Azure Speech ---
    const azureKey = "DKRXk8ueSfo5NdIOMqFRTCAfpeGDezJ3Snf5K8gGgtyqxiWdugLzJQQJ99BLACHYHv6XJ3w3AAAYACOGUYP9";
    const azureRegion = "eastus2"; 
    let synthesizer = null;

    function speak(text) {
        if (synthesizer) { synthesizer.close(); synthesizer = null; }
        try {
            const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(azureKey, azureRegion);
            speechConfig.speechSynthesisVoiceName = "en-US-AriaNeural"; 
            const audioConfig = SpeechSDK.AudioConfig.fromDefaultSpeakerOutput();
            synthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig, audioConfig);
            
            synthesizer.speakTextAsync(text, res => { 
                synthesizer.close(); 
                synthesizer = null;
            }, err => {
                console.error(err);
                synthesizer.close();
                synthesizer = null;
            });
        } catch (e) { console.error(e); }
    }

    // --- Navigation ---
    function goToScene(id) {
        document.querySelectorAll('.scene').forEach(s => {
            s.classList.remove('active');
            s.style.opacity = 0;
        });
        const next = document.getElementById('scene-' + id);
        next.style.display = 'flex';
        setTimeout(() => {
            next.classList.add('active');
            next.style.opacity = 1;
        }, 50);
    }

    function hideElements(ids) {
        ids.forEach(id => document.getElementById(id).style.display = 'none');
    }

    // --- Scene 1: Spelling ---
    const inputs = document.querySelectorAll('.sound-input');
    inputs.forEach((input, idx) => {
        input.addEventListener('input', () => {
            if(input.value.length === input.maxLength && idx < inputs.length - 1) inputs[idx+1].focus();
        });
        input.addEventListener('keydown', (e) => {
            if(e.key === 'Backspace' && input.value === '' && idx > 0) inputs[idx-1].focus();
        });
    });

    function checkSpelling() {
        let allCorrect = true;
        inputs.forEach(input => {
            if(input.value.toLowerCase() === input.dataset.ans) {
                input.classList.add('correct'); input.classList.remove('wrong');
            } else {
                input.classList.add('wrong'); input.classList.remove('correct'); allCorrect = false;
            }
        });

        const feedback = document.getElementById('feedback-msg');
        if(allCorrect) {
            feedback.innerText = "Perfect! Let's see the story.";
            feedback.style.color = "var(--secondary)";
            speak("Adventure! Perfect.");
            
            // Show Next Button
            document.getElementById('check-btn').style.display = 'none';
            document.getElementById('next-scene-btn').style.display = 'inline-block';
        } else {
            feedback.innerText = "Check the red boxes again.";
            feedback.style.color = "#e74c3c";
            speak("Try again.");
        }
    }

    function revealOneLetter() {
        for(let input of inputs) {
            if(input.value.toLowerCase() !== input.dataset.ans) {
                input.value = input.dataset.ans;
                input.classList.add('correct'); input.classList.remove('wrong');
                speak(input.dataset.ans);
                break; 
            }
        }
    }

    function startStoryScene() {
        goToScene(2);
        initStory();
    }

    // --- Scene 2: Story ---
    let storyStep = 0;
    const img = document.getElementById('comic-img');
    const storyBtn = document.getElementById('story-btn');

    function initStory() {
        document.getElementById('step1-q').style.display = 'block';
    }

    function advanceStory() {
        storyStep++;
        if (storyStep === 1) { 
            document.getElementById('step1-a').style.display = 'block';
            speak("Yes. They have a map. Is this an adventure yet? No, just a planned trip.");
            storyBtn.innerText = "Show Panel 2 (The Problem)";
            storyBtn.className = "btn btn-green";
        } else if (storyStep === 2) {
            img.style.clipPath = 'inset(0 33.3% 0 0)';
            hideElements(['step1-q', 'step1-a']);
            document.getElementById('step2-q').style.display = 'block';
            storyBtn.innerText = "Reveal Answer";
            storyBtn.className = "btn"; 
        } else if (storyStep === 3) {
            document.getElementById('step2-a').style.display = 'block';
            speak("They are lost! A normal trip follows a plan. But here, something unexpected has happened.");
            storyBtn.innerText = "Show Panel 3 (The Discovery)";
            storyBtn.className = "btn btn-green";
        } else if (storyStep === 4) {
            img.style.clipPath = 'inset(0 0 0 0)';
            hideElements(['step2-q', 'step2-a']);
            document.getElementById('step3-q').style.display = 'block';
            storyBtn.innerText = "Reveal Conclusion";
            storyBtn.className = "btn";
        } else if (storyStep === 5) {
            document.getElementById('step3-a').style.display = 'block';
            speak("Yes! They found a secret waterfall. This is an Adventure.");
            storyBtn.innerText = "What does Adventure mean? ‚Üí";
            storyBtn.className = "btn btn-green";
        } else if (storyStep === 6) {
            goToScene(3);
        }
    }

    // --- Scene 3: Card Flip ---
    function toggleCard(card, keyword) {
        if (!card.classList.contains('revealed')) {
            card.classList.add('revealed');
            speak(keyword);
        }
    }

    // --- Scene 4: Toggle Text ---
    function toggleText(id) {
        const el = document.getElementById(id);
        el.classList.toggle('hidden');
    }

</script>

</body>
</html>