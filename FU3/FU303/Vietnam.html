<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore: Vietnam (Pro)</title>
    
    <script src="https://cdn.staticfile.net/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.staticfile.net/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.staticfile.net/babel-standalone/7.22.17/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=Fredoka:wght@500;600&family=Noto+Serif:ital,wght@0,500;1,500&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

    <style>
        /* ÂÖ®Â±ÄËÆæÁΩÆ */
        * { -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Outfit', sans-serif; 
            color: #f8fafc; 
            /* Ë∂äÂçóÁ∫¢ÁªøÊ∏êÂèò */
            background: linear-gradient(135deg, #991b1b, #dc2626, #14532d, #166534);
            background-size: 400% 400%;
            animation: vietnamFlow 25s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        @keyframes vietnamFlow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .serif { font-family: 'Noto Serif', serif; }
        .mono { font-family: 'Space Grotesk', monospace; }
        .fun-font { font-family: 'Fredoka', sans-serif; }

        /* ‰∏ªÂÆπÂô® */
        .app-container {
            width: 95vw;
            max-width: 1400px;
            height: 90vh;
            background: rgba(127, 29, 29, 0.9); /* Ê∑±Á∫¢Â∫ïËâ≤ */
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 32px;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            overflow: hidden;
            position: relative;
        }
        
        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            .app-container { flex-direction: column; height: 100vh; width: 100vw; border-radius: 0; }
        }

        /* Âä®Áîª */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ÊªöÂä®Êù° */
        .custom-scroll { overflow-y: auto; scrollbar-width: thin; scrollbar-color: rgba(253, 224, 71, 0.3) transparent; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(253, 224, 71, 0.3); border-radius: 10px; }

        /* ÊªëÂùó */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 28px; width: 28px; border-radius: 50%;
            background: #facc15; border: 4px solid white; cursor: pointer; margin-top: -12px;
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.6); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:active { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; cursor: pointer; 
            background: rgba(255,255,255,0.2); border-radius: 10px;
        }

        /* ËøîÂõûÊåâÈíÆ */
        .nav-back { 
            position: absolute; top: 24px; left: 24px; z-index: 50; 
            background: rgba(0,0,0,0.6); color: white; 
            padding: 10px 20px; border-radius: 99px; text-decoration: none; 
            backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.2); 
            font-weight: 600; font-size: 1rem;
            transition: all 0.2s; display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .nav-back:hover { background: rgba(0,0,0,0.8); transform: scale(1.05); }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // üîπ Azure ËØ≠Èü≥ÈÖçÁΩÆ
        // ==========================================
        const azureKey = "DKRXk8ueSfo5NdIOMqFRTCAfpeGDezJ3Snf5K8gGgtyqxiWdugLzJQQJ99BLACHYHv6XJ3w3AAAYACOGUYP9";
        const azureRegion = "eastus2"; 
        
        let currentSynthesizer = null;

        const speak = (text, onComplete) => {
            if (currentSynthesizer) { currentSynthesizer.close(); currentSynthesizer = null; }
            if (!text) { if(onComplete) onComplete(); return; }
            
            try {
                const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(azureKey, azureRegion);
                speechConfig.speechSynthesisVoiceName = "en-US-JennyNeural"; 
                const audioConfig = SpeechSDK.AudioConfig.fromDefaultSpeakerOutput();
                const synthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig, audioConfig);
                currentSynthesizer = synthesizer;
                
                synthesizer.speakTextAsync(text, result => {
                    synthesizer.close(); currentSynthesizer = null;
                    if(onComplete) onComplete();
                }, err => { console.error(err); synthesizer.close(); currentSynthesizer = null; if(onComplete) onComplete(); });
            } catch (e) { console.error("Azure Error", e); if(onComplete) onComplete(); }
        };

        // ==========================================
        // üîπ Êï∞ÊçÆÈÖçÁΩÆ
        // ==========================================
        const CONTENT = {
            intro: "Xin Chao! Let's explore Vietnam.",
            
            // Step 1: Gallery
            imgs: ["bac ha market sapa.jpg", "bac ha market sapa_01.jpg", "bac ha market sapa_02.jpg"],
            
            // Step 2: Spell Country
            country_word: "Vietnam",
            country_hint: "A beautiful S-shaped country",
            country_sounds: [
                { char: "V", w: "w-12" }, { char: "i", w: "w-12" }, { char: "e", w: "w-12" },
                { char: "t", w: "w-12" }, { char: "n", w: "w-12" }, { char: "a", w: "w-12" },
                { char: "m", w: "w-12" }
            ],

            // Step 3: Market Info
            market_title: "Bac Ha Market",
            market_en: "Located in the mountains of Sapa, Bac Ha Market is the largest and most colorful market in the area. Every Sunday, local hill tribes gather here to trade handmade goods and traditional food, wearing their bright costumes.",
            market_cn: "ÂåóÊ≤≥Â∏ÇÂú∫‰Ωç‰∫éÊ≤ôÂ∑¥Â±±Âå∫ÔºåÊòØËØ•Âú∞Âå∫ÊúÄÂ§ß„ÄÅËâ≤ÂΩ©ÊúÄ‰∏∞ÂØåÁöÑÂ∏ÇÂú∫„ÄÇÊØè‰∏™ÊòüÊúüÂ§©ÔºåÂΩìÂú∞ÁöÑÂ±±Âú∞ÈÉ®ËêΩÈÉΩ‰ºöËÅöÈõÜÂú®ËøôÈáåÔºåË∫´ÁùÄÈ≤úËâ≥ÁöÑ‰º†ÁªüÊúçÈ•∞Ôºå‰∫§ÊòìÊâãÂ∑•Âà∂ÂìÅÂíå‰º†ÁªüÈ£üÁâ©„ÄÇ",

            // Step 4: Culture Facts
            facts_title: "Cultural Wonders",
            
            fact1_title: "Motorbike Kingdom",
            fact1_en: "Vietnam is known as the Kingdom of Motorbikes! In big cities like Hanoi and Ho Chi Minh City, millions of motorbikes fill the streets, carrying everything from families to refrigerators.",
            fact1_cn: "Ë∂äÂçóË¢´Áß∞‰∏∫‚ÄúÊë©ÊâòËΩ¶ÁéãÂõΩ‚ÄùÔºÅÂú®Ê≤≥ÂÜÖÂíåËÉ°ÂøóÊòéÂ∏ÇÁ≠âÂ§ßÂüéÂ∏ÇÔºåÊï∞Áôæ‰∏áËæÜÊë©ÊâòËΩ¶ÂÖÖÊñ•Ë°óÂ§¥ÔºåËøêËΩΩÁùÄ‰ªé‰∏ÄÂÆ∂‰∫∫Âà∞ÂÜ∞ÁÆ±Á≠âÂêÑÁßçÁâ©ÂìÅ„ÄÇ",

            fact2_title: "Coffee Culture",
            fact2_en: "Vietnam is the world's second-largest coffee exporter. The locals love their strong iced coffee with condensed milk (Ca Phe Sua Da) and the unique Egg Coffee.",
            fact2_cn: "Ë∂äÂçóÊòØ‰∏ñÁïåÁ¨¨‰∫åÂ§ßÂíñÂï°Âá∫Âè£ÂõΩ„ÄÇÂΩìÂú∞‰∫∫ÂñúÁà±ÊµìÈÉÅÁöÑÁÇº‰π≥ÂÜ∞ÂíñÂï°ÔºàCa Phe Sua DaÔºâ‰ª•ÂèäÁã¨ÁâπÁöÑËõãÂíñÂï°„ÄÇ"
        };

        // ==========================================
        // üîπ ÁªÑ‰ª∂Âå∫Âüü
        // ==========================================

        const App = () => {
            const [view, setView] = useState('focus'); 
            // views: 'focus' -> 'spell_vietnam' -> 'info_market' -> 'info_culture'
            
            const [focusVal, setFocusVal] = useState(0);
            const [imgIdx, setImgIdx] = useState(0);
            
            useEffect(() => { setTimeout(() => speak(CONTENT.intro), 800); }, []);

            // ÂàáÊç¢ÂõæÁâá
            const changeImage = (dir) => {
                const total = CONTENT.imgs.length;
                let next = imgIdx + dir;
                if (next >= total) next = 0;
                if (next < 0) next = total - 1;
                setImgIdx(next);
            };

            // ÊµÅÁ®ãÊéßÂà∂
            const nextStep = (nextView, speechText) => {
                speak(speechText, () => {
                    setTimeout(() => setView(nextView), 500);
                });
            };

            return (
                <div className="app-container fade-in">
                    
                    {/* 1. Â∑¶‰æßÔºöÁõ∏Êú∫ÂèñÊôØÂô® */}
                    <div className="flex-1 md:flex-[1.8] relative bg-black overflow-hidden border-b-4 md:border-b-0 md:border-r-4 border-yellow-500/50 group h-[40vh] md:h-auto">
                        <a href="FU303Main.html" className="nav-back">
                            <i className="ph ph-arrow-u-up-left text-xl"></i> Back to Map
                        </a>

                        <div className="w-full h-full overflow-hidden relative">
                            
                            {/* ‰ªÖÂú® Focus Êàñ Info Èò∂ÊÆµÂèØ‰ª•ÂàáÂõæ */}
                            {(view === 'focus' || view.startsWith('info')) && (
                                <>
                                    <button onClick={(e) => { e.stopPropagation(); changeImage(-1); }} className="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/30 hover:bg-black/60 text-white flex items-center justify-center backdrop-blur-md z-30 transition border border-white/20 hover:scale-110"><i className="ph ph-caret-left text-2xl"></i></button>
                                    <button onClick={(e) => { e.stopPropagation(); changeImage(1); }} className="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/30 hover:bg-black/60 text-white flex items-center justify-center backdrop-blur-md z-30 transition border border-white/20 hover:scale-110"><i className="ph ph-caret-right text-2xl"></i></button>
                                    <div className="absolute bottom-24 left-1/2 -translate-x-1/2 flex gap-2 z-30">
                                        {CONTENT.imgs.map((_, i) => (
                                            <div key={i} className={`w-2 h-2 rounded-full transition-all ${i === imgIdx ? 'bg-yellow-400 w-6' : 'bg-white/40'}`}></div>
                                        ))}
                                    </div>
                                </>
                            )}

                            <img 
                                key={imgIdx}
                                src={CONTENT.imgs[imgIdx]} 
                                className="w-full h-full object-cover transition-all duration-500 transform scale-110 animate-[fadeIn_0.5s]"
                                style={{ 
                                    filter: `blur(${view === 'focus' ? Math.max(0, 20 - (focusVal / 4)) : 0}px) brightness(${0.6 + (focusVal/300)})`,
                                    transform: `scale(${1.1 - (focusVal/1000)})` 
                                }}
                                onError={(e) => e.target.src = 'https://placehold.co/1200x800/991b1b/facc15?text=Bac+Ha+Market'}
                            />
                            {view !== 'focus' && !view.startsWith('info') && <div className="absolute inset-0 bg-red-900/40 mix-blend-multiply transition-all"></div>}
                        </div>

                        <div className="absolute inset-0 pointer-events-none p-8 flex flex-col justify-between z-10">
                            <div className="flex justify-between items-start">
                                <div className="text-red-500 font-mono font-bold animate-pulse flex items-center gap-3 bg-black/40 px-3 py-1 rounded backdrop-blur-sm">
                                    <div className="w-3 h-3 bg-red-500 rounded-full shadow-[0_0_10px_red]"></div> REC
                                </div>
                                <div className="text-white/80 font-mono text-sm flex flex-col items-end gap-1">
                                    <span>ISO 200</span> <span className="text-yellow-400">AF-S</span>
                                </div>
                            </div>
                            <div className="flex justify-between items-end text-white/60 font-mono text-sm">
                                <div>SAPA, VIETNAM</div>
                                <div className={`${focusVal > 90 ? 'text-yellow-400 font-bold' : 'text-white'}`}>FOCUS: {focusVal}%</div>
                            </div>
                        </div>
                    </div>

                    {/* 2. Âè≥‰æßÔºöÊéßÂà∂Èù¢Êùø */}
                    <div className="flex-1 bg-slate-900/60 backdrop-blur-3xl border-l border-white/5 relative flex flex-col h-[60vh] md:h-auto overflow-hidden">
                        
                        {/* ËøõÂ∫¶Êù° */}
                        <div className="flex justify-center gap-2 pt-6 pb-2 shrink-0">
                            {['focus', 'spell_vietnam', 'info_market', 'info_culture'].map((v, i) => (
                                <div key={v} className={`h-1.5 w-10 rounded-full transition-all ${view === v ? 'bg-yellow-400 shadow-[0_0_10px_#facc15]' : 'bg-slate-600'}`}></div>
                            ))}
                        </div>

                        <div className="flex-1 relative overflow-y-auto custom-scroll p-6 md:p-8">
                            <div className="min-h-full flex flex-col items-center justify-center">
                            
                                {/* --- Phase 1: Focus --- */}
                                {view === 'focus' && (
                                    <div className="w-full flex flex-col items-center fade-in">
                                        <h2 className="text-yellow-200 font-bold uppercase tracking-[0.2em] text-xs mb-4">Step 1: Identify</h2>
                                        <div className="bg-red-900/30 text-yellow-100 px-6 py-4 rounded-2xl border border-yellow-500/20 inline-block font-medium shadow-lg w-full max-w-sm text-center mb-10">
                                            <i className="ph ph-aperture mr-2 align-middle"></i> "Adjust focus to reveal the market."
                                        </div>
                                        <div className="w-full max-w-sm mb-8 relative group">
                                            <div className="flex justify-between text-xs text-slate-400 mb-3 font-mono tracking-widest">
                                                <span>BLUR</span><span>SHARP</span>
                                            </div>
                                            <input type="range" min="0" max="100" value={focusVal} 
                                                onChange={(e) => {
                                                    const v = parseInt(e.target.value);
                                                    setFocusVal(v);
                                                    if(v > 90) nextStep('spell_vietnam', "Excellent! Now, spell the country.");
                                                }}
                                                className="w-full h-2 rounded-lg appearance-none cursor-pointer bg-slate-700"
                                            />
                                        </div>
                                    </div>
                                )}

                                {/* --- Phase 2: Spell Vietnam --- */}
                                {view === 'spell_vietnam' && (
                                    <MappingInterface 
                                        title="Step 2: Spell Country"
                                        word={CONTENT.country_word}
                                        sounds={CONTENT.country_sounds}
                                        hint={CONTENT.country_hint}
                                        onComplete={() => nextStep('info_market', "Correct! Welcome to Vietnam.")} 
                                    />
                                )}

                                {/* --- Phase 3: Info Market --- */}
                                {view === 'info_market' && (
                                    <div className="w-full fade-in flex flex-col items-center gap-6">
                                        <div className="text-center">
                                            <span className="text-yellow-500 font-bold tracking-widest text-xs uppercase mb-2 block">Destination</span>
                                            <h1 className="text-3xl font-black text-white mb-2">{CONTENT.country_word}</h1>
                                        </div>
                                        
                                        <div className="bg-gradient-to-b from-white/10 to-white/5 p-6 rounded-3xl border border-white/10 text-left shadow-2xl relative overflow-hidden w-full">
                                            <h3 className="text-yellow-400 font-bold uppercase tracking-widest text-xs mb-2">Featured Spot: {CONTENT.market_title}</h3>
                                            <p className="serif text-lg text-yellow-50 mb-3 leading-relaxed">"{CONTENT.market_en}"</p>
                                            <p className="text-slate-400 text-sm mb-4 leading-relaxed">{CONTENT.market_cn}</p>
                                            <div className="flex justify-end gap-3">
                                                <button onClick={() => speak(CONTENT.market_en)} className="px-4 py-2 rounded-full bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold"><i className="ph ph-speaker-high"></i> Listen</button>
                                                <button onClick={() => nextStep('info_culture', "Let's discover some fun facts!")} className="px-4 py-2 rounded-full bg-green-700 hover:bg-green-600 text-white text-sm font-bold flex items-center gap-2">Discover <i className="ph ph-arrow-right"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* --- Phase 4: Info Culture --- */}
                                {view === 'info_culture' && (
                                    <div className="w-full fade-in flex flex-col items-center gap-6">
                                        <h1 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-red-200 mb-2">{CONTENT.facts_title}</h1>
                                        
                                        {/* Card 1: Motorbikes */}
                                        <div className="bg-slate-800/50 p-5 rounded-2xl border border-white/5 hover:border-yellow-500/50 transition-all w-full">
                                            <div className="flex items-center gap-3 mb-2">
                                                <i className="ph ph-scooter text-2xl text-yellow-400"></i>
                                                <h4 className="text-lg font-bold text-white">{CONTENT.fact1_title}</h4>
                                            </div>
                                            <p className="text-sm text-slate-300 mb-2 leading-relaxed">{CONTENT.fact1_en}</p>
                                            <p className="text-xs text-slate-500 mb-2">{CONTENT.fact1_cn}</p>
                                            <button onClick={() => speak(CONTENT.fact1_en)} className="text-xs font-bold text-yellow-500 hover:text-white flex items-center gap-1 transition">
                                                <i className="ph ph-speaker-high"></i> Listen
                                            </button>
                                        </div>

                                        {/* Card 2: Coffee */}
                                        <div className="bg-slate-800/50 p-5 rounded-2xl border border-white/5 hover:border-green-500/50 transition-all w-full">
                                            <div className="flex items-center gap-3 mb-2">
                                                <i className="ph ph-coffee text-2xl text-green-400"></i>
                                                <h4 className="text-lg font-bold text-white">{CONTENT.fact2_title}</h4>
                                            </div>
                                            <p className="text-sm text-slate-300 mb-2 leading-relaxed">{CONTENT.fact2_en}</p>
                                            <p className="text-xs text-slate-500 mb-2">{CONTENT.fact2_cn}</p>
                                            <button onClick={() => speak(CONTENT.fact2_en)} className="text-xs font-bold text-green-400 hover:text-white flex items-center gap-1 transition">
                                                <i className="ph ph-speaker-high"></i> Listen
                                            </button>
                                        </div>
                                    </div>
                                )}

                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Sub-component: Mapping Interface ---
        const MappingInterface = ({ title, word, sounds, hint, onComplete }) => {
            const [inputs, setInputs] = useState(Array(sounds.length).fill(""));
            const [status, setStatus] = useState("idle");
            const inputsRef = useRef([]);

            const handleChange = (val, i) => {
                const maxLen = sounds[i].char.length;
                const newInputs = [...inputs];
                let nextVal = val.toLowerCase();
                if (nextVal.length <= maxLen) {
                    newInputs[i] = nextVal;
                    setInputs(newInputs);
                    setStatus("idle");
                    if (nextVal.length === maxLen && i < sounds.length - 1) inputsRef.current[i + 1].focus();
                }
            };

            const handleKeyDown = (e, i) => {
                if (e.key === "Backspace" && !inputs[i] && i > 0) inputsRef.current[i - 1].focus();
            };

            const check = () => {
                const isCorrect = inputs.every((val, i) => val === sounds[i].char.toLowerCase());
                setStatus(isCorrect ? "correct" : "wrong");
                if (isCorrect) onComplete();
                else speak("Try again.");
            };

            return (
                <div className="w-full flex flex-col items-center fade-in">
                    <h2 className="text-yellow-200 font-bold uppercase tracking-[0.2em] text-xs mb-6">{title}</h2>
                    <button onClick={() => speak(word)} className="w-20 h-20 rounded-full bg-red-600 hover:bg-red-500 text-white flex items-center justify-center shadow-lg mb-4 transition animate-bounce">
                        <i className="ph ph-speaker-high text-3xl"></i>
                    </button>
                    <p className="text-slate-300 mb-8 font-mono text-center">{hint}</p>
                    
                    <div className="flex flex-wrap justify-center gap-2 mb-10 max-w-full items-end">
                        {sounds.map((sound, i) => (
                            <div key={i} className="flex flex-col items-center">
                                <input
                                    ref={el => inputsRef.current[i] = el}
                                    type="text"
                                    value={inputs[i]}
                                    maxLength={sound.char.length}
                                    onChange={(e) => handleChange(e.target.value, i)}
                                    onKeyDown={(e) => handleKeyDown(e, i)}
                                    className={`${sound.w} h-12 md:h-16 rounded-xl border-4 text-center text-xl md:text-3xl font-bold mono focus:outline-none focus:-translate-y-1 transition shadow-sm
                                        ${status === 'correct' ? 'border-green-400 bg-green-50 text-green-700' : 
                                          status === 'wrong' ? 'border-red-400 bg-red-50 text-red-700' : 
                                          'border-slate-200 bg-white text-slate-800 focus:border-yellow-400'}`}
                                />
                            </div>
                        ))}
                    </div>

                    <button onClick={check} className="px-10 py-4 bg-slate-800 text-white rounded-full font-bold text-lg shadow-xl hover:bg-slate-700 transition active:scale-95 flex items-center gap-3">
                        Check Spelling <i className="ph ph-check-circle text-xl"></i>
                    </button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>