<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore: France (Pro V2)</title>
    
    <script src="https://cdn.staticfile.net/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.staticfile.net/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.staticfile.net/babel-standalone/7.22.17/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=Fredoka:wght@500;600&family=Noto+Serif:ital,wght@0,500;1,500&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">

    <style>
        /* ÂÖ®Â±ÄËÆæÁΩÆ */
        * { -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Outfit', sans-serif; 
            color: #f8fafc; 
            /* ÂçàÂ§úÂ∑¥ÈªéÊ∏êÂèò */
            background: linear-gradient(135deg, #0f172a, #312e81, #4c1d95, #be185d);
            background-size: 400% 400%;
            animation: parisNight 25s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        @keyframes parisNight { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .serif { font-family: 'Noto Serif', serif; }
        .elegant { font-family: 'Playfair Display', serif; }
        .mono-font { font-family: 'Fredoka', sans-serif; }

        /* ‰∏ªÂÆπÂô® */
        .app-container {
            width: 95vw;
            max-width: 1400px;
            height: 90vh;
            background: rgba(30, 27, 75, 0.85);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 32px;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            overflow: hidden;
            position: relative;
        }
        
        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            .app-container { flex-direction: column; height: 100vh; width: 100vw; border-radius: 0; }
        }

        /* Âä®Áîª */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ÊªöÂä®Êù° */
        .custom-scroll { overflow-y: auto; scrollbar-width: thin; scrollbar-color: rgba(236, 72, 153, 0.3) transparent; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(236, 72, 153, 0.3); border-radius: 10px; }

        /* ÊªëÂùó */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 28px; width: 28px; border-radius: 50%;
            background: #ec4899; border: 4px solid white; cursor: pointer; margin-top: -12px;
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.6); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:active { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; cursor: pointer; 
            background: rgba(255,255,255,0.2); border-radius: 10px;
        }

        /* ËøîÂõûÊåâÈíÆ */
        .nav-back { 
            position: absolute; top: 24px; left: 24px; z-index: 50; 
            background: rgba(0,0,0,0.6); color: white; 
            padding: 10px 20px; border-radius: 99px; text-decoration: none; 
            backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.2); 
            font-weight: 600; font-size: 1rem;
            transition: all 0.2s; display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .nav-back:hover { background: rgba(0,0,0,0.8); transform: scale(1.05); }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // üîπ Azure ËØ≠Èü≥ÈÖçÁΩÆ
        // ==========================================
        const azureKey = "DKRXk8ueSfo5NdIOMqFRTCAfpeGDezJ3Snf5K8gGgtyqxiWdugLzJQQJ99BLACHYHv6XJ3w3AAAYACOGUYP9";
        const azureRegion = "eastus2"; 
        
        let currentSynthesizer = null;

        const speak = (text, onComplete) => {
            if (currentSynthesizer) { currentSynthesizer.close(); currentSynthesizer = null; }
            if (!text) { if(onComplete) onComplete(); return; }
            
            try {
                const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(azureKey, azureRegion);
                speechConfig.speechSynthesisVoiceName = "en-US-JennyNeural"; 
                const audioConfig = SpeechSDK.AudioConfig.fromDefaultSpeakerOutput();
                const synthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig, audioConfig);
                currentSynthesizer = synthesizer;
                
                synthesizer.speakTextAsync(text, result => {
                    synthesizer.close(); currentSynthesizer = null;
                    if(onComplete) onComplete();
                }, err => { console.error(err); synthesizer.close(); currentSynthesizer = null; if(onComplete) onComplete(); });
            } catch (e) { console.error("Azure Error", e); if(onComplete) onComplete(); }
        };

        // ==========================================
        // üîπ Êï∞ÊçÆÈÖçÁΩÆ
        // ==========================================
        const CONTENT = {
            title: "The Eiffel Tower",
            // ÊãºÂÜô‰ªªÂä°Êï∞ÊçÆ (ÂèåËØç)
            spelling_tasks: [
                {
                    word: "France",
                    sounds: ["f", "r", "a", "n", "ce"], // ce ‰Ωú‰∏∫‰∏Ä‰∏™Êï¥‰Ωì
                    hint: "Country Name"
                },
                {
                    word: "French",
                    sounds: ["f", "r", "e", "n", "ch"], // ch ‰Ωú‰∏∫‰∏Ä‰∏™Êï¥‰Ωì
                    hint: "Language / People"
                }
            ],
            // ÂéÜÂè≤‰ªãÁªç
            desc_en: "Designed by Gustave Eiffel, the Eiffel Tower is the global symbol of France and the French people. Standing 330 meters tall, this 'Iron Lady' offers breathtaking views of Paris.",
            desc_cn: "ÂüÉËè≤Â∞îÈìÅÂ°îÁî±Âè§ÊñØÂ°îÂ§´¬∑ÂüÉËè≤Â∞îËÆæËÆ°ÔºåÊòØÊ≥ïÂõΩÂíåÊ≥ïÂõΩ‰∫∫Ê∞ëÁöÑÂÖ®ÁêÉË±°ÂæÅ„ÄÇËøô‰Ωç‚ÄúÈìÅÂ®òÂ≠ê‚ÄùÈ´ò330Á±≥Ôºå‰∏ç‰ªÖËÉΩ‰øØÁû∞Â∑¥ÈªéÁæéÊôØÔºåÊõ¥‰ª£Ë°®‰∫ÜÊµ™Êº´‰∏éÂª∫Á≠ëÁöÑÂ•áËøπ„ÄÇ",
            // ÁßëÂ≠¶ÂÜ∑Áü•ËØÜ
            science_title: "Science Secret",
            science_en: "Did you know the Eiffel Tower grows in summer? Due to thermal expansion, the iron structure can expand and grow taller by up to 15 centimeters (6 inches) when temperatures rise!",
            science_cn: "‰Ω†Áü•ÈÅìÂüÉËè≤Â∞îÈìÅÂ°îÂú®Â§èÂ§©‰ºöÂèòÈ´òÂêóÔºüÁî±‰∫é‚ÄúÁÉ≠ËÉÄÂÜ∑Áº©‚ÄùÂéüÁêÜÔºåÂΩìÊ∞îÊ∏©ÂçáÈ´òÊó∂ÔºåÈìÅÂ°îÁöÑÈáëÂ±ûÁªìÊûÑÊúÄÂ§ö‰ºöËÜ®ËÉÄ‰º∏Èïø15ÂéòÁ±≥ÔºÅ",
            
            intro: "Let's adjust the lens to reveal the symbol of France."
        };

        // ==========================================
        // üîπ ÁªÑ‰ª∂Âå∫Âüü
        // ==========================================

        const App = () => {
            const [view, setView] = useState('focus'); // focus | mapping | learn
            const [focusVal, setFocusVal] = useState(0);
            
            useEffect(() => { setTimeout(() => speak(CONTENT.intro), 800); }, []);

            const handleFocusComplete = () => {
                speak("Magnifique! Now, let's learn the words.");
                setTimeout(() => setView('mapping'), 1000);
            };

            const handleMappingComplete = () => {
                speak("Perfect! You mastered both words.", () => {
                    setTimeout(() => setView('learn'), 500);
                });
            };

            return (
                <div className="app-container fade-in">
                    
                    {/* 1. Â∑¶‰æßÔºöÁõ∏Êú∫ÂèñÊôØÂô® */}
                    <div className="flex-1 md:flex-[1.8] relative bg-black overflow-hidden border-b-4 md:border-b-0 md:border-r-4 border-slate-700/50 group h-[40vh] md:h-auto">
                        <a href="FU303Main.html" className="nav-back">
                            <i className="ph ph-arrow-u-up-left text-xl"></i> Back to Map
                        </a>

                        <div className="w-full h-full overflow-hidden relative">
                            <img 
                                src="eiffel_tower.jpg" 
                                className="w-full h-full object-cover transition-all duration-300 transform scale-110"
                                style={{ 
                                    filter: `blur(${Math.max(0, 20 - (focusVal / 4))}px) brightness(${0.5 + (focusVal/200)})`,
                                    transform: `scale(${1.1 - (focusVal/1000)})` 
                                }}
                                onError={(e) => e.target.src = 'https://placehold.co/1200x800/240b36/ec4899?text=Eiffel+Tower'}
                            />
                            {view !== 'focus' && <div className="absolute inset-0 bg-pink-500/10 mix-blend-overlay animate-pulse"></div>}
                        </div>

                        {/* Áõ∏Êú∫ UI */}
                        <div className="absolute inset-0 pointer-events-none p-8 flex flex-col justify-between z-10">
                            <div className="flex justify-between items-start">
                                <div className="text-red-500 font-mono font-bold animate-pulse flex items-center gap-3 bg-black/40 px-3 py-1 rounded backdrop-blur-sm">
                                    <div className="w-3 h-3 bg-red-500 rounded-full shadow-[0_0_10px_red]"></div> REC
                                </div>
                                <div className="text-white/80 font-mono text-sm flex flex-col items-end gap-1">
                                    <span>ISO 100</span>
                                    <span className="text-pink-400">AF-S</span>
                                </div>
                            </div>
                            
                            <div className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 transition-all duration-300 ${view !== 'focus' ? 'w-full h-full border-4 border-pink-500/50' : 'w-64 h-48 border-2 border-white/30'}`}>
                                {view === 'focus' ? (
                                    <>
                                        <div className="absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-white"></div>
                                        <div className="absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-white"></div>
                                        <div className="absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-white"></div>
                                        <div className="absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-white"></div>
                                        <div className="w-2 h-2 bg-white/50 rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
                                    </>
                                ) : (
                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-pink-400 font-black tracking-widest text-3xl animate-ping opacity-50">LOCKED</div>
                                )}
                            </div>

                            <div className="flex justify-between items-end text-white/60 font-mono text-sm">
                                <div>PARIS, FRANCE</div>
                                <div className={`${focusVal > 90 ? 'text-pink-400 font-bold' : 'text-white'}`}>FOCUS: {focusVal}%</div>
                            </div>
                        </div>
                    </div>

                    {/* 2. Âè≥‰æßÔºöÊéßÂà∂Èù¢Êùø */}
                    <div className="flex-1 bg-slate-900/60 backdrop-blur-3xl border-l border-white/5 relative flex flex-col h-[60vh] md:h-auto overflow-hidden">
                        
                        {/* ËøõÂ∫¶Êù° */}
                        <div className="flex justify-center gap-2 pt-6 pb-2 shrink-0">
                            {['focus', 'mapping', 'learn'].map((v, i) => (
                                <div key={v} className={`h-1.5 w-12 rounded-full transition-all ${view === v ? 'bg-pink-500 shadow-[0_0_10px_#ec4899]' : 'bg-slate-600'}`}></div>
                            ))}
                        </div>

                        <div className="flex-1 relative overflow-y-auto custom-scroll p-6 md:p-8">
                            <div className="min-h-full flex flex-col items-center justify-center">
                            
                                {/* --- Phase 1: Focus --- */}
                                {view === 'focus' && (
                                    <div className="w-full flex flex-col items-center fade-in">
                                        <h2 className="text-pink-200 font-bold uppercase tracking-[0.2em] text-xs mb-4">Step 1: Identify</h2>
                                        <div className="bg-pink-500/10 text-pink-200 px-6 py-4 rounded-2xl border border-pink-500/20 inline-block font-medium shadow-lg w-full max-w-sm text-center mb-10">
                                            <i className="ph ph-aperture mr-2 align-middle"></i> "Adjust focus to clear the image."
                                        </div>

                                        <div className="w-full max-w-sm mb-8 relative group">
                                            <div className="flex justify-between text-xs text-slate-400 mb-3 font-mono tracking-widest">
                                                <span>BLUR</span><span>SHARP</span>
                                            </div>
                                            <input 
                                                type="range" min="0" max="100" value={focusVal} 
                                                onChange={(e) => {
                                                    const v = parseInt(e.target.value);
                                                    setFocusVal(v);
                                                    if(v > 90) handleFocusComplete();
                                                }}
                                                className="w-full h-2 rounded-lg appearance-none cursor-pointer bg-slate-700"
                                            />
                                        </div>
                                    </div>
                                )}

                                {/* --- Phase 2: Mapping (Dual Words) --- */}
                                {view === 'mapping' && (
                                    <MappingInterface 
                                        tasks={CONTENT.spelling_tasks} 
                                        onComplete={handleMappingComplete} 
                                    />
                                )}

                                {/* --- Phase 3: Learn --- */}
                                {view === 'learn' && (
                                    <div className="w-full fade-in flex flex-col items-center gap-6 pb-8">
                                        
                                        <div className="text-center">
                                            <h1 className="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-200 via-white to-pink-100 mb-2 drop-shadow-sm elegant">
                                                {CONTENT.title}
                                            </h1>
                                            <button onClick={() => speak(CONTENT.title)} className="p-2 rounded-full text-pink-400 hover:text-white transition">
                                                <i className="ph ph-speaker-high text-2xl"></i>
                                            </button>
                                        </div>

                                        {/* Card 1: History */}
                                        <div className="bg-gradient-to-b from-white/10 to-white/5 p-6 rounded-3xl border border-white/10 text-left shadow-2xl relative overflow-hidden w-full">
                                            <div className="absolute top-0 right-0 p-4 opacity-10"><i className="ph ph-heart text-8xl text-pink-200"></i></div>
                                            <h3 className="text-pink-400 font-bold uppercase tracking-widest text-xs mb-2">History & Symbol</h3>
                                            <p className="serif text-lg text-pink-50 mb-3 leading-relaxed relative z-10">"{CONTENT.desc_en}"</p>
                                            <p className="text-slate-400 text-sm mb-4 leading-relaxed">{CONTENT.desc_cn}</p>
                                            <div className="text-right">
                                                <button onClick={() => speak(CONTENT.desc_en)} className="px-4 py-2 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-white shadow-lg transition gap-2 ml-auto font-bold text-sm">
                                                    <i className="ph ph-speaker-high"></i> Listen
                                                </button>
                                            </div>
                                        </div>

                                        {/* Card 2: Science Secret */}
                                        <div className="bg-gradient-to-br from-indigo-900/40 to-slate-900/40 p-6 rounded-3xl border border-indigo-500/30 text-left shadow-2xl relative overflow-hidden w-full group">
                                            <div className="absolute -bottom-4 -right-4 p-4 opacity-20 text-indigo-500"><i className="ph ph-thermometer text-8xl"></i></div>
                                            <h3 className="text-indigo-400 font-bold uppercase tracking-widest text-xs mb-2 flex items-center gap-2">
                                                <i className="ph ph-flask"></i> {CONTENT.science_title}
                                            </h3>
                                            <p className="serif text-lg text-white mb-3 leading-relaxed relative z-10 font-medium">"{CONTENT.science_en}"</p>
                                            <p className="text-slate-400 text-sm mb-4 leading-relaxed">{CONTENT.science_cn}</p>
                                            <div className="text-right relative z-10">
                                                <button onClick={() => speak(CONTENT.science_en)} className="px-5 py-2 rounded-full bg-indigo-600 hover:bg-indigo-500 flex items-center justify-center text-white shadow-lg shadow-indigo-900/50 transition gap-2 ml-auto font-bold text-sm">
                                                    <i className="ph ph-speaker-high"></i> Learn Fact
                                                </button>
                                            </div>
                                        </div>

                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Sub-component: Mapping Interface (Multi-word) ---
        const MappingInterface = ({ tasks, onComplete }) => {
            const [step, setStep] = useState(0); // 0 = France, 1 = French
            const currentTask = tasks[step];
            
            const [inputs, setInputs] = useState(Array(currentTask.sounds.length).fill(""));
            const [status, setStatus] = useState("idle");
            const inputsRef = useRef([]);

            // Reset inputs when step changes
            useEffect(() => {
                setInputs(Array(currentTask.sounds.length).fill(""));
                setStatus("idle");
                inputsRef.current = [];
            }, [step]);

            const handleChange = (val, i) => {
                const maxLen = currentTask.sounds[i].length;
                const newInputs = [...inputs];
                let nextVal = val.toLowerCase();
                
                // Allow input up to maxLen
                if (nextVal.length <= maxLen) {
                    newInputs[i] = nextVal;
                    setInputs(newInputs);
                    setStatus("idle");
                    // Auto-focus next if max length reached
                    if (nextVal.length === maxLen && i < currentTask.sounds.length - 1) {
                        inputsRef.current[i + 1].focus();
                    }
                }
            };

            const handleKeyDown = (e, i) => {
                if (e.key === "Backspace" && !inputs[i] && i > 0) inputsRef.current[i - 1].focus();
            };

            const check = () => {
                const isCorrect = inputs.every((val, i) => val === currentTask.sounds[i]);
                setStatus(isCorrect ? "correct" : "wrong");
                
                if (isCorrect) {
                    speak(`Correct! ${currentTask.word}.`, () => {
                        if (step < tasks.length - 1) {
                            setTimeout(() => setStep(step + 1), 1000); // Next word
                        } else {
                            setTimeout(onComplete, 500); // Finish all
                        }
                    });
                } else {
                    speak("Try again.");
                }
            };

            return (
                <div className="w-full flex flex-col items-center fade-in" key={step}>
                    <h2 className="text-pink-200 font-bold uppercase tracking-[0.2em] text-xs mb-6">
                        Step 2: Sound Mapping ({step + 1}/{tasks.length})
                    </h2>
                    
                    <button onClick={() => speak(currentTask.word)} className="w-24 h-24 rounded-full bg-pink-600 hover:bg-pink-500 text-white flex items-center justify-center shadow-lg mb-4 transition animate-bounce">
                        <i className="ph ph-speaker-high text-4xl"></i>
                    </button>
                    
                    <p className="text-slate-300 mb-8 font-mono">{currentTask.hint}</p>
                    
                    <div className="flex flex-wrap justify-center gap-3 mb-10 items-end">
                        {currentTask.sounds.map((sound, i) => {
                            // Âä®ÊÄÅÂÆΩÂ∫¶ÔºöÂ¶ÇÊûúÊòØ ce, ch ËøôÁßçÂ§öÂ≠óÊØçÔºåÂÆΩ‰∏ÄÁÇπ
                            const widthClass = sound.length > 1 ? "w-16 md:w-20" : "w-12 md:w-14";
                            
                            return (
                                <div key={i} className="flex flex-col items-center">
                                    <input
                                        ref={el => inputsRef.current[i] = el}
                                        type="text"
                                        value={inputs[i]}
                                        maxLength={sound.length}
                                        onChange={(e) => handleChange(e.target.value, i)}
                                        onKeyDown={(e) => handleKeyDown(e, i)}
                                        className={`${widthClass} h-16 md:h-20 rounded-xl border-4 text-center text-3xl font-bold mono-font focus:outline-none focus:-translate-y-2 transition shadow-sm
                                            ${status === 'correct' ? 'border-green-400 bg-green-50 text-green-700' : 
                                              status === 'wrong' ? 'border-red-400 bg-red-50 text-red-700' : 
                                              'border-slate-200 bg-white text-slate-800 focus:border-pink-400'}`}
                                    />
                                </div>
                            );
                        })}
                    </div>

                    <button onClick={check} className="px-10 py-4 bg-slate-800 text-white rounded-full font-bold text-lg shadow-xl hover:bg-slate-700 transition active:scale-95 flex items-center gap-3">
                        Check Spelling <i className="ph ph-check-circle text-xl"></i>
                    </button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>