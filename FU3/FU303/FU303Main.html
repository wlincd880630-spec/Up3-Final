<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Explorer: Main Map (Pro V2)</title>
    
    <script src="https://cdn.staticfile.net/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.staticfile.net/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.staticfile.net/babel-standalone/7.22.17/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Fredoka:wght@600&display=swap" rel="stylesheet">

    <style>
        /* å…¨å±€è®¾ç½® */
        * { -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Outfit', sans-serif; 
            color: #e2e8f0; 
            /* å‡çº§ç‰ˆæå…‰èƒŒæ™¯ (ä¸ FU302 ç»Ÿä¸€) */
            background: linear-gradient(135deg, #0f172a, #312e81, #4c1d95, #581c87);
            background-size: 400% 400%;
            animation: gradient 25s ease infinite;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        /* ç»ç’ƒé¢æ¿ (ä¸»å®¹å™¨) */
        .app-frame { 
            width: 95vw;
            height: 90vh;
            max-width: 1600px;
            background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(24px); 
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
            border-radius: 32px;
            position: relative;
            overflow: hidden;
        }

        /* åŠ¨ç”» */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* åœ°å›¾ Pin ç‚¹ */
        .map-pin {
            position: absolute;
            transform: translate(-50%, -100%);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            z-index: 20;
        }
        .map-pin:hover { transform: translate(-50%, -115%) scale(1.25); z-index: 30; }
        
        .pin-head {
            background: #ef4444;
            width: 28px; height: 28px;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }
        .pin-label {
            position: absolute;
            top: -35px; left: 50%; transform: translateX(-50%);
            background: white; color: #0f172a;
            padding: 6px 12px; border-radius: 12px;
            font-weight: 800; font-size: 14px;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0; transition: all 0.2s;
            pointer-events: none;
            transform: translateY(10px);
        }
        .map-pin:hover .pin-label { opacity: 1; transform: translateY(0); }

        /* é£æœº */
        .plane-sprite {
            position: absolute;
            width: 70px;
            z-index: 40;
            filter: drop-shadow(0 20px 30px rgba(0,0,0,0.6));
            transition: top 2.5s cubic-bezier(0.45, 0, 0.55, 1), left 2.5s cubic-bezier(0.45, 0, 0.55, 1), transform 1s ease-in-out;
            pointer-events: none;
        }

        /* ä¿®å¤åçš„é¡¶éƒ¨å¯¼èˆªæŒ‰é’®æ ·å¼ (é absolute) */
        .nav-btn { 
            background: rgba(255,255,255,0.1); color: white; 
            padding: 10px 20px; border-radius: 99px; text-decoration: none; 
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); 
            font-weight: 600; font-size: 1rem;
            transition: all 0.2s; display: flex; align-items: center; gap: 8px;
            pointer-events: auto; cursor: pointer;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

        /* å¡ç‰‡ Hover å…‰æ•ˆ */
        .sector-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .sector-card:hover {
            transform: translateY(-10px);
            border-color: rgba(255,255,255,0.4);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 50px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // ğŸ”¹ Azure è¯­éŸ³é…ç½®
        // ==========================================
        const azureKey = "DKRXk8ueSfo5NdIOMqFRTCAfpeGDezJ3Snf5K8gGgtyqxiWdugLzJQQJ99BLACHYHv6XJ3w3AAAYACOGUYP9";
        const azureRegion = "eastus2"; 
        
        let currentSynthesizer = null;

        const speak = (text) => {
            if (currentSynthesizer) { currentSynthesizer.close(); currentSynthesizer = null; }
            if (!text) return;
            
            try {
                const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(azureKey, azureRegion);
                speechConfig.speechSynthesisVoiceName = "en-US-JennyNeural"; 
                const audioConfig = SpeechSDK.AudioConfig.fromDefaultSpeakerOutput();
                const synthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig, audioConfig);
                currentSynthesizer = synthesizer;
                
                synthesizer.speakTextAsync(text, result => {
                    synthesizer.close(); currentSynthesizer = null;
                }, err => { console.error(err); synthesizer.close(); currentSynthesizer = null; });
            } catch (e) { console.error("Azure Error", e); }
        };

        // ==========================================
        // ğŸ”¹ åœ°å›¾æ•°æ®é…ç½®
        // ==========================================
        const MAP_DATA = {
            west: {
                id: 'west',
                title: 'America & Europe',
                bg: 'world_map_bg 01.jpg',
                pins: [
                    { id: 'p1', name: 'Arctic Ocean', top: 15, left: 53, url: 'Arctic Ocean.html' },
                    { id: 'p2', name: 'USA', top: 62, left: 18, url: 'USA.html' },
                    { id: 'p3', name: 'Atlantic Ocean', top: 80, left: 48, url: 'Atlantic Ocean.html' },
                    { id: 'p4', name: 'Britain', top: 50, left: 65, url: 'Britain.html' },
                    { id: 'p5', name: 'France', top: 59, left: 71, url: 'France.html' }
                ]
            },
            east: {
                id: 'east',
                title: 'Asia & Oceania',
                bg: 'world_map_bg 02.jpg',
                pins: [
                    { id: 'p6', name: 'Egypt', top: 22, left: 27, url: 'Egypt.html' },
                    { id: 'p7', name: 'Jordan', top: 20, left: 38, url: 'Jordan.html' },
                    { id: 'p8', name: 'Russia', top: 16, left: 60, url: 'Russia.html' },
                    { id: 'p9', name: 'Mongolia', top: 22, left: 65, url: 'Mongolia.html' },
                    { id: 'p10', name: 'Thailand', top: 38, left: 50, url: 'Thailand.html' },
                    { id: 'p11', name: 'Vietnam', top: 41, left: 60, url: 'Vietnam.html' },
                    { id: 'p12', name: 'Indonesia', top: 56, left: 53, url: 'Indonesia.html' },
                    { id: 'p13', name: 'New Zealand', top: 85, left: 68, url: 'New Zealand.html' }
                ]
            }
        };

        // ==========================================
        // ğŸ”¹ é¡µé¢ç»„ä»¶
        // ==========================================

        // 1. Landing View (å…¨æ–°è®¾è®¡)
        const LandingView = ({ onSelectMap }) => {
            return (
                <div className="w-full h-full flex flex-col items-center justify-center p-8 fade-in relative overflow-hidden">
                    
                    {/* è¿”å› Home æŒ‰é’® (ç»å¯¹å®šä½ï¼Œç‹¬ç«‹äºå¸ƒå±€) */}
                    <a href="../../index.html" className="absolute top-8 left-8 nav-btn z-50">
                        <i className="ph ph-house text-xl"></i> Home
                    </a>

                    {/* è£…é¥°å¤§æ ‡é¢˜ */}
                    <div className="text-center mb-16 relative z-10">
                        <h1 className="text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-200 via-white to-purple-200 drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]" style={{fontFamily: 'Fredoka'}}>
                            Global Explorer
                        </h1>
                        <p className="text-blue-200 text-xl mt-4 font-light tracking-widest uppercase">Select Your Destination Sector</p>
                    </div>

                    {/* å¡ç‰‡å®¹å™¨ */}
                    <div className="flex flex-col md:flex-row gap-8 items-center justify-center w-full max-w-6xl relative z-10">
                        
                        {/* West Sector */}
                        <div onClick={() => onSelectMap('west')} 
                             className="sector-card cursor-pointer group relative w-full md:w-1/3 h-96 bg-gradient-to-b from-slate-800/40 to-slate-900/40 rounded-[2rem] border border-white/10 overflow-hidden flex flex-col items-center justify-center text-center p-6">
                            <div className="absolute inset-0 bg-blue-500/10 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                            <div className="w-32 h-32 rounded-full bg-blue-500/20 flex items-center justify-center mb-6 group-hover:scale-110 transition duration-500 border border-blue-400/30 shadow-[0_0_30px_rgba(59,130,246,0.3)]">
                                <i className="ph ph-globe-hemisphere-west text-6xl text-blue-300"></i>
                            </div>
                            <h2 className="text-3xl font-bold text-white mb-2">West Sector</h2>
                            <p className="text-slate-400 text-sm">Americas â€¢ Europe â€¢ Atlantic</p>
                            <div className="mt-6 px-6 py-2 rounded-full border border-blue-400/50 text-blue-300 text-sm font-bold opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition duration-300">
                                ENTER <i className="ph ph-arrow-right ml-1"></i>
                            </div>
                        </div>

                        {/* Special Discovery */}
                        <div onClick={() => window.location.href='Destination.html'} 
                             className="sector-card cursor-pointer group relative w-full md:w-1/3 h-[28rem] bg-gradient-to-b from-purple-900/40 to-slate-900/40 rounded-[2rem] border-2 border-purple-500/30 overflow-hidden flex flex-col items-center justify-center text-center p-6 shadow-[0_0_40px_rgba(168,85,247,0.15)] z-20 transform md:-translate-y-4">
                            <div className="absolute inset-0 bg-purple-500/10 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                            <div className="w-40 h-40 rounded-full bg-purple-500/20 flex items-center justify-center mb-8 group-hover:scale-110 transition duration-500 border border-purple-400/30 shadow-[0_0_40px_rgba(168,85,247,0.4)] animate-pulse">
                                <i className="ph ph-paper-plane-right text-7xl text-purple-200"></i>
                            </div>
                            <h2 className="text-4xl font-bold text-white mb-2">Discovery</h2>
                            <p className="text-purple-200 text-sm">Where to next?</p>
                            <div className="mt-8 px-8 py-3 rounded-full bg-purple-600 hover:bg-purple-500 text-white font-bold shadow-lg transition duration-300">
                                Launch Lesson
                            </div>
                        </div>

                        {/* East Sector */}
                        <div onClick={() => onSelectMap('east')} 
                             className="sector-card cursor-pointer group relative w-full md:w-1/3 h-96 bg-gradient-to-b from-slate-800/40 to-slate-900/40 rounded-[2rem] border border-white/10 overflow-hidden flex flex-col items-center justify-center text-center p-6">
                            <div className="absolute inset-0 bg-teal-500/10 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                            <div className="w-32 h-32 rounded-full bg-teal-500/20 flex items-center justify-center mb-6 group-hover:scale-110 transition duration-500 border border-teal-400/30 shadow-[0_0_30px_rgba(45,212,191,0.3)]">
                                <i className="ph ph-globe-hemisphere-east text-6xl text-teal-300"></i>
                            </div>
                            <h2 className="text-3xl font-bold text-white mb-2">East Sector</h2>
                            <p className="text-slate-400 text-sm">Asia â€¢ Oceania â€¢ Pacific</p>
                            <div className="mt-6 px-6 py-2 rounded-full border border-teal-400/50 text-teal-300 text-sm font-bold opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition duration-300">
                                ENTER <i className="ph ph-arrow-right ml-1"></i>
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        // 2. Map View (å¸ƒå±€ä¿®å¤ç‰ˆ)
        const MapView = ({ mapData, onBack }) => {
            const [planePos, setPlanePos] = useState({ top: '80%', left: '10%', rotate: 0 });
            
            // åˆå§‹åŒ–é£æœºä½ç½®
            useEffect(() => {
                const lastTop = sessionStorage.getItem('lastPlaneTop');
                const lastLeft = sessionStorage.getItem('lastPlaneLeft');
                if (lastTop && lastLeft) {
                    setPlanePos({ top: lastTop, left: lastLeft, rotate: 0 });
                } else {
                    setPlanePos({ top: '80%', left: '10%', rotate: 45 });
                }
            }, []);

            const flyTo = (pin) => {
                const targetTop = (pin.top - 5) + '%';
                const targetLeft = (pin.left) + '%';
                
                const currentLeftVal = parseFloat(planePos.left);
                const isFlyingRight = pin.left > currentLeftVal;
                const rotation = isFlyingRight ? 15 : -15; 

                speak(`Flying to ${pin.name}...`);

                setPlanePos({ 
                    top: targetTop, 
                    left: targetLeft, 
                    rotate: rotation,
                    scale: isFlyingRight ? 1 : -1 
                });

                sessionStorage.setItem('lastPlaneTop', targetTop);
                sessionStorage.setItem('lastPlaneLeft', targetLeft);

                setTimeout(() => {
                    window.location.href = pin.url;
                }, 2500);
            };

            return (
                <div className="w-full h-full relative bg-slate-900 overflow-hidden fade-in flex flex-col">
                    
                    {/* é¡¶éƒ¨æ§åˆ¶æ  (å…³é”®ä¿®å¤ï¼šFlexå¸ƒå±€ï¼Œé˜²æ­¢é‡å ) */}
                    <div className="w-full p-6 flex justify-between items-center z-50 bg-gradient-to-b from-black/50 to-transparent">
                        <button onClick={onBack} className="nav-btn shadow-lg">
                            <i className="ph ph-arrow-u-up-left text-lg"></i> Change Map
                        </button>
                        
                        <div className="bg-white/10 backdrop-blur-md text-white px-6 py-2 rounded-full font-mono text-sm border border-white/20 shadow-lg flex items-center gap-2">
                            <span className="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
                            SECTOR: <span className="text-blue-300 font-bold">{mapData.title.toUpperCase()}</span>
                        </div>
                    </div>

                    {/* åœ°å›¾åŒºåŸŸ - å±…ä¸­æ˜¾ç¤º */}
                    <div className="flex-1 w-full relative flex items-center justify-center p-4 overflow-hidden">
                        <div className="relative w-full max-w-[1400px] aspect-video rounded-3xl overflow-hidden shadow-2xl border border-white/10 bg-slate-800 group">
                            
                            {/* èƒŒæ™¯å›¾ */}
                            <img src={mapData.bg} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-700" 
                                 onError={(e) => e.target.parentElement.style.background = '#1e293b'} />

                            {/* é£æœº */}
                            <img src="plane_icon.png" 
                                 className="plane-sprite"
                                 style={{
                                     top: planePos.top,
                                     left: planePos.left,
                                     transform: `translate(-50%, -50%) rotate(${planePos.rotate}deg) scaleX(${planePos.scale || 1}) scale(1.5)`
                                 }}
                                 onError={(e) => e.target.style.display = 'none'} 
                            />

                            {/* Pins */}
                            {mapData.pins.map(pin => (
                                <div key={pin.id} 
                                     className="map-pin"
                                     style={{ top: `${pin.top}%`, left: `${pin.left}%` }}
                                     onClick={() => flyTo(pin)}>
                                    <div className="pin-head"></div>
                                    <div className="pin-label">{pin.name}</div>
                                </div>
                            ))}

                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App Shell ---
        const App = () => {
            const [view, setView] = useState('landing');
            const [currentMapKey, setCurrentMapKey] = useState(null);

            useEffect(() => {
                const savedMap = sessionStorage.getItem('currentMap');
                if (savedMap && MAP_DATA[savedMap]) {
                    setCurrentMapKey(savedMap);
                    setView('map');
                }
            }, []);

            const handleSelectMap = (key) => {
                sessionStorage.setItem('currentMap', key);
                sessionStorage.removeItem('lastPlaneTop');
                sessionStorage.removeItem('lastPlaneLeft');
                setCurrentMapKey(key);
                setView('map');
            };

            const handleBack = () => {
                sessionStorage.removeItem('currentMap');
                setView('landing');
            };

            return (
                <div className="app-frame">
                    {view === 'landing' && <LandingView onSelectMap={handleSelectMap} />}
                    {view === 'map' && <MapView mapData={MAP_DATA[currentMapKey]} onBack={handleBack} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>